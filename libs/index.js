(()=>{"use strict";var e={33:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0});const o=r(7861),i=r(7729);class n extends o.Model{toJSON(){const e=super.toJSON();return e&&"object"==typeof e&&(delete e.password,delete e.forgotPassword,delete e.activationCode),e}}n.tableName=i.constants.TableName.Partners,n.idColumn="id",t.default=n},43:function(e,t,r){var o=this&&this.__createBinding||(Object.create?function(e,t,r,o){void 0===o&&(o=r);var i=Object.getOwnPropertyDescriptor(t,r);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,o,i)}:function(e,t,r,o){void 0===o&&(o=r),e[o]=t[r]}),i=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||o(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),i(r(3523),t)},107:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0})},113:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0})},138:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0});const o=r(7861);class i extends o.Model{}i.tableName="Permissions",i.idColumn="id",i.jsonSchema={type:"object",properties:{id:{type:"integer"},moduleId:{type:"integer"},moduleName:{type:"string"},slug:{type:"string"},name:{type:"string"},path:{type:"string"},method:{type:"string"},deps:{type:"array",items:{type:"string"}},tMenus:{type:"array",items:{type:"string"}}}},t.default=i},171:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0});const o=r(7861),i=r(7729);class n extends o.Model{}n.tableName=i.constants.TableName.WorkOrderStatus,n.idColumn="id",n.jsonSchema={type:"object",properties:{id:{type:"integer"},slug:{type:"string"},name:{type:"string"},createdAt:{type:"string"},createdBy:{type:"integer"}}},t.default=n},193:function(e,t,r){var o=this&&this.__decorate||function(e,t,r,o){var i,n=arguments.length,s=n<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(s=(n<3?i(s):n>3?i(t,r,s):i(t,r))||s);return n>3&&s&&Object.defineProperty(t,r,s),s},i=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(t,"__esModule",{value:!0}),t.UpdateChargeDto=t.CreateChargeDto=void 0;const n=r(6325),s=r(2520);class a{constructor(){this.currency="MYR"}}t.CreateChargeDto=a,o([(0,s.ApiProperty)({description:"Work Order ID associated with the charge",example:101}),(0,n.IsNotEmpty)(),(0,n.IsNumber)(),i("design:type",Number)],a.prototype,"workOrderId",void 0),o([(0,s.ApiProperty)({description:"Name or description of the charge",example:"Service Fee"}),(0,n.IsNotEmpty)(),(0,n.IsString)(),i("design:type",String)],a.prototype,"name",void 0),o([(0,s.ApiProperty)({description:"Amount of the charge",example:150}),(0,n.IsNotEmpty)(),(0,n.IsNumber)(),(0,n.Min)(0),i("design:type",Number)],a.prototype,"amount",void 0),o([(0,s.ApiProperty)({description:"Currency code",example:"MYR",default:"MYR"}),(0,n.IsOptional)(),(0,n.IsString)(),i("design:type",String)],a.prototype,"currency",void 0);class l{}t.UpdateChargeDto=l,o([(0,s.ApiPropertyOptional)({description:"Name or description of the charge",example:"Service Fee (Updated)"}),(0,n.IsOptional)(),(0,n.IsString)(),i("design:type",String)],l.prototype,"name",void 0),o([(0,s.ApiPropertyOptional)({description:"Amount of the charge",example:200}),(0,n.IsOptional)(),(0,n.IsNumber)(),(0,n.Min)(0),i("design:type",Number)],l.prototype,"amount",void 0),o([(0,s.ApiPropertyOptional)({description:"Currency code",example:"USD"}),(0,n.IsOptional)(),(0,n.IsString)(),i("design:type",String)],l.prototype,"currency",void 0)},225:(e,t)=>{var r;Object.defineProperty(t,"__esModule",{value:!0}),t.UserStatusEnum=void 0,function(e){e.Active="Active",e.Inactive="Inactive"}(r||(t.UserStatusEnum=r={}))},266:function(e,t,r){var o=this&&this.__createBinding||(Object.create?function(e,t,r,o){void 0===o&&(o=r);var i=Object.getOwnPropertyDescriptor(t,r);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,o,i)}:function(e,t,r,o){void 0===o&&(o=r),e[o]=t[r]}),i=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||o(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),i(r(5057),t),i(r(8352),t)},274:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0})},284:e=>{e.exports=require("class-transformer")},287:function(e,t,r){var o=this&&this.__decorate||function(e,t,r,o){var i,n=arguments.length,s=n<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(s=(n<3?i(s):n>3?i(t,r,s):i(t,r))||s);return n>3&&s&&Object.defineProperty(t,r,s),s};Object.defineProperty(t,"__esModule",{value:!0}),t.LibraryService=void 0;const i=r(1813);let n=class{constructor(){this.sampleData=[{id:1,name:"Product A",category:"Electronics",price:299.99},{id:2,name:"Product B",category:"Home Appliance",price:499.99},{id:3,name:"Product C",category:"Electronics",price:199.99},{id:4,name:"Service Plan Basic",category:"Service",price:49.99},{id:5,name:"Service Plan Premium",category:"Service",price:99.99}]}getSampleData(){return this.sampleData}getSampleDataById(e){return this.sampleData.find(t=>t.id===e)}getLibraryInfo(){return{name:"cakrawala-hub-library-api",version:"1.0.0"}}};t.LibraryService=n,t.LibraryService=n=o([(0,i.Injectable)()],n)},345:function(e,t,r){var o,i,n=this&&this.__decorate||function(e,t,r,o){var i,n=arguments.length,s=n<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(s=(n<3?i(s):n>3?i(t,r,s):i(t,r))||s);return n>3&&s&&Object.defineProperty(t,r,s),s},s=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},a=this&&this.__param||function(e,t){return function(r,o){t(r,o,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.NatsService=void 0;const l=r(1813),c=r(5780),d=r(573);let u=o=class{constructor(e){this.client=e,this.logger=new l.Logger(o.name)}async emit(e,t){try{await(0,d.firstValueFrom)(this.client.emit(e,t)),this.logger.debug(`[NATS][EMIT] subject ${e} data=${t?.title}`)}catch(t){this.logger.error(`NATS emit failed to ${e}: ${t?.message||t}`);const r=new Error(`NATS emit failed to ${e}: ${t?.message||t}`);throw r.cause=t,r}}async send(e,t){const r=await(0,d.firstValueFrom)(this.client.send(e,t));if(this.logger.debug(`[NATS][SEND] subject=${e} data=${t?.title}`),void 0===r)throw new Error(`No response received for pattern: ${e}`);return r}};t.NatsService=u,t.NatsService=u=o=n([(0,l.Injectable)(),a(0,(0,l.Inject)("NATS_SERVICE")),s("design:paramtypes",["function"==typeof(i=void 0!==c.ClientProxy&&c.ClientProxy)?i:Object])],u)},410:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0});const o=r(7861);class i extends o.Model{}i.tableName="Menus",i.idColumn="id",i.jsonSchema={type:"object",properties:{id:{type:"integer"},moduleId:{type:"integer"},group:{type:"string"},group_order:{type:"integer"},name:{type:"string"},slug:{type:"string"},action:{type:"string"},type:{type:"string"},order:{type:"integer"},parent_id:{type:"integer"}}},t.default=i},467:function(e,t,r){var o=this&&this.__decorate||function(e,t,r,o){var i,n=arguments.length,s=n<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(s=(n<3?i(s):n>3?i(t,r,s):i(t,r))||s);return n>3&&s&&Object.defineProperty(t,r,s),s},i=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(t,"__esModule",{value:!0}),t.UpdateUserDto=t.CreateUserDto=void 0;const n=r(6325),s=r(5007);class a{}t.CreateUserDto=a,o([(0,n.IsInt)({message:"Role ID must be an integer"}),(0,n.IsOptional)(),i("design:type",Number)],a.prototype,"roleId",void 0),o([(0,n.IsInt)({message:"Transcxp ID must be an integer"}),(0,n.IsOptional)(),i("design:type",Number)],a.prototype,"transcxpId",void 0),o([(0,n.IsInt)({message:"Territory ID must be an integer"}),(0,n.IsOptional)(),i("design:type",Number)],a.prototype,"territoryId",void 0),o([(0,n.IsInt)({message:"NSC Branch ID must be an integer"}),(0,n.IsOptional)(),i("design:type",Number)],a.prototype,"nscBranchId",void 0),o([(0,n.IsString)({message:"Salutation must be a string"}),(0,n.IsOptional)(),i("design:type",String)],a.prototype,"salutation",void 0),o([(0,n.IsEmail)({},{message:"Email must be a valid email address"}),(0,n.IsOptional)(),i("design:type",String)],a.prototype,"email",void 0),o([(0,n.IsString)({message:"Account name must be a string"}),(0,n.MinLength)(3,{message:"Account name must be at least 3 characters long"}),i("design:type",String)],a.prototype,"accountName",void 0),o([(0,n.IsString)({message:"First name must be a string"}),(0,n.MinLength)(2,{message:"First name must be at least 2 characters long"}),i("design:type",String)],a.prototype,"firstName",void 0),o([(0,n.IsString)({message:"Middle name must be a string"}),(0,n.IsOptional)(),i("design:type",String)],a.prototype,"middleName",void 0),o([(0,n.IsString)({message:"Last name must be a string"}),(0,n.MinLength)(2,{message:"Last name must be at least 2 characters long"}),i("design:type",String)],a.prototype,"lastName",void 0),o([(0,n.IsPhoneNumber)(null,{message:"Mobile phone must be a valid phone number"}),(0,n.IsOptional)(),i("design:type",String)],a.prototype,"mobilePhone",void 0),o([(0,n.IsPhoneNumber)(null,{message:"Home phone must be a valid phone number"}),(0,n.IsOptional)(),i("design:type",String)],a.prototype,"homePhone",void 0),o([(0,n.IsPhoneNumber)(null,{message:"Business phone must be a valid phone number"}),(0,n.IsOptional)(),i("design:type",String)],a.prototype,"businessPhone",void 0),o([(0,n.IsString)({message:"Suffix must be a string"}),(0,n.IsOptional)(),i("design:type",String)],a.prototype,"suffix",void 0),o([(0,n.IsString)({message:"Tax payer ID must be a string"}),(0,n.IsOptional)(),i("design:type",String)],a.prototype,"taxPayerId",void 0),o([(0,n.IsString)({message:"Gender must be a string"}),(0,n.IsOptional)(),i("design:type",String)],a.prototype,"gender",void 0),o([(0,n.IsString)({message:"Status must be a string"}),(0,n.IsOptional)(),i("design:type",String)],a.prototype,"status",void 0),o([(0,n.IsString)({message:"Remark must be a string"}),(0,n.IsOptional)(),i("design:type",String)],a.prototype,"remark",void 0);class l extends((0,s.PartialType)(a)){}t.UpdateUserDto=l},494:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.WarrantyService=t.WarrantyModule=void 0;var o=r(4332);Object.defineProperty(t,"WarrantyModule",{enumerable:!0,get:function(){return o.WarrantyModule}});var i=r(5501);Object.defineProperty(t,"WarrantyService",{enumerable:!0,get:function(){return i.WarrantyService}})},573:e=>{e.exports=require("rxjs")},581:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.transformFilterObject=l,t.filtersTransformer=function e(t){if(t.type!=i.TransformationType.PLAIN_TO_CLASS)throw new Error(`Unsupported ${i.TransformationType[t.type]} transformation`);const r=t.value;if(Array.isArray(r))return new n.PaginationFilterOrDto(...r.map(r=>e.call(this,{...t,value:r})));if((0,o.isPlainObject)(r)){for(const e in r)r[e]=l(r[e]);return(0,i.plainToInstance)(n.PaginationFilterAndDto,r)}return r},t.sortsTransformer=function({value:e}){(0,o.isPlainObject)(e)?e=Object.entries(e).map(([e,t])=>({[e]:(0,a.paginationSanitizeSortValue)(t)})):Array.isArray(e)&&e.forEach(e=>Object.keys(e).forEach(t=>e[t]=(0,a.paginationSanitizeSortValue)(e[t])));return e};const o=r(7546),i=r(284),n=r(1495),s=r(1495),a=r(3020);function l(e){switch(typeof e){case"number":case"string":e={op:"equal",value:e}}switch(e.op){case"equal":case"notEqual":return(0,i.plainToInstance)(s.FilterObjectEqualityDto,e);case"lessThan":case"greaterThan":return(0,i.plainToInstance)(s.FilterObjectLessGreaterDto,e);case"between":return(0,i.plainToInstance)(s.FilterObjectBetweenDto,e);case"like":return(0,i.plainToInstance)(s.FilterObjectLikeDto,e);case"isNull":case"isNotNull":return(0,i.plainToInstance)(s.FilterObjectNullDto,e);case"in":case"notIn":return(0,i.plainToInstance)(s.FilterObjectInDto,e);default:return(0,i.plainToInstance)(s.FilterObjectDto,e)}}},606:function(e,t,r){var o=this&&this.__createBinding||(Object.create?function(e,t,r,o){void 0===o&&(o=r);var i=Object.getOwnPropertyDescriptor(t,r);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,o,i)}:function(e,t,r,o){void 0===o&&(o=r),e[o]=t[r]}),i=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||o(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),i(r(5033),t),i(r(2152),t)},803:function(e,t,r){var o=this&&this.__createBinding||(Object.create?function(e,t,r,o){void 0===o&&(o=r);var i=Object.getOwnPropertyDescriptor(t,r);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,o,i)}:function(e,t,r,o){void 0===o&&(o=r),e[o]=t[r]}),i=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||o(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),i(r(6578),t),i(r(9227),t)},823:function(e,t,r){var o,i=this&&this.__decorate||function(e,t,r,o){var i,n=arguments.length,s=n<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(s=(n<3?i(s):n>3?i(t,r,s):i(t,r))||s);return n>3&&s&&Object.defineProperty(t,r,s),s},n=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},s=this&&this.__param||function(e,t){return function(r,o){t(r,o,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.PartnerService=void 0;const a=r(1813),l=r(1944),c=r(7976),d=r(1706),u=r(6088),p=r(9044),f=r(4014),g=r(4413),y=r(1712);let m=class{constructor(e){this.logger=e,this.PARTNER_SEARCH_COLUMNS=["idText","name","email","mobilePhone","updatedByName"],e||(this.logger=new a.Logger("PartnerService"))}async checkEmailExists(e,t){let r=l.UserModel.query().where("email",e);t&&(r=r.whereNot("id",t));return!!await r.first()}async checkMobilePhoneExists(e,t){let r=l.UserModel.query().where("mobilePhone",e);t&&(r=r.whereNot("id",t));return!!await r.first()}async checkBusinessPhoneExists(e,t){let r=l.UserModel.query().where("businessPhone",e);t&&(r=r.whereNot("id",t));return!!await r.first()}async validateUniqueFieldsForCreate(e){const t={};if(e.email){await this.checkEmailExists(e.email)&&(t.email="email is exist")}if(e.mobilePhone){await this.checkMobilePhoneExists(e.mobilePhone)&&(t.mobilePhone="mobile phone is exist")}if(e.businessPhone){await this.checkBusinessPhoneExists(e.businessPhone)&&(t.businessPhone="business phone is exist")}if(Object.keys(t).length>0){const e=[];throw Object.entries(t).forEach(([t,r])=>{e.push({property:t,constraints:{unique:r}})}),new p.ValidationException(e)}}async validateUniqueFieldsForUpdate(e,t){const r=await l.PartnerModel.query().findById(e);if(!r)throw new a.NotFoundException(`Partner with ID ${e} not found`);const o={};if(t.email){await this.checkEmailExists(t.email,r.userId)&&(o.email="email is exist")}if(t.mobilePhone){await this.checkMobilePhoneExists(t.mobilePhone,r.userId)&&(o.mobilePhone="mobile phone is exist")}if(t.businessPhone){await this.checkBusinessPhoneExists(t.businessPhone,r.userId)&&(o.businessPhone="business phone is exist")}if(Object.keys(o).length>0){const e=[];throw Object.entries(o).forEach(([t,r])=>{e.push({property:t,constraints:{unique:r}})}),new p.ValidationException(e)}}buildPartnersSubquery(){return l.PartnerModel.query().join("Users","Partners.userId","=","Users.id").leftJoin("Users as CreatedByUser","Partners.createdBy","=","CreatedByUser.id").leftJoin("Users as UpdatedByUser","Partners.updatedBy","=","UpdatedByUser.id").where("Partners.deletedAt","is",null).select("Partners.id","Users.email","Users.firstName","Users.middleName","Users.lastName","Users.mobilePhone","Partners.lastLogin","Partners.createdAt","Partners.updatedAt","Users.status",l.PartnerModel.raw('CAST("Partners"."id" AS TEXT) as "idText"'),l.PartnerModel.raw('CONCAT("Users"."firstName", \' \', COALESCE("Users"."middleName", \'\'), \' \', "Users"."lastName") as "name"'),l.PartnerModel.raw('CASE \n          WHEN COALESCE("CreatedByUser"."firstName", \'\') = \'\' \n            AND COALESCE("CreatedByUser"."middleName", \'\') = \'\' \n            AND COALESCE("CreatedByUser"."lastName", \'\') = \'\' \n          THEN \'\'\n          ELSE TRIM(CONCAT(COALESCE("CreatedByUser"."firstName", \'\'), \' \', COALESCE("CreatedByUser"."middleName", \'\'), \' \', COALESCE("CreatedByUser"."lastName", \'\')))\n        END as "createdByName"'),l.PartnerModel.raw('CASE \n          WHEN COALESCE("UpdatedByUser"."firstName", \'\') = \'\' \n            AND COALESCE("UpdatedByUser"."middleName", \'\') = \'\' \n            AND COALESCE("UpdatedByUser"."lastName", \'\') = \'\' \n          THEN \'\'\n          ELSE TRIM(CONCAT(COALESCE("UpdatedByUser"."firstName", \'\'), \' \', COALESCE("UpdatedByUser"."middleName", \'\'), \' \', COALESCE("UpdatedByUser"."lastName", \'\')))\n        END as "updatedByName"'))}async listAllPartners(e,t){let r,o;this.logger.log("initialization query - building subquery");const i=l.PartnerModel.query().from(this.buildPartnersSubquery().as("subquery"));this.logger.log("count data from subquery");const n=l.PartnerModel.query().from(this.buildPartnersSubquery().as("subquery")).count("* as count");if(e.filters){this.logger.log("apply filters data");const t=(0,d.processSearchFilterWithColumns)(e.filters,this.PARTNER_SEARCH_COLUMNS);(0,g.applyFilters)(t,i),(0,g.applyFilters)(t,n)}e.sorts&&(this.logger.log("apply sort data"),(0,g.applySorts)(e.sorts,i)),e instanceof f.PaginationDto&&(r=e.page,o=e.count,this.logger.log("apply pagination data"),(0,g.applyPagination)({page:r,count:o},i));const[s,a]=await Promise.all([i,n]);return{page:r,count:o,total:parseInt(a[0]?.count),items:s}}async findPartnerById(e,t){const r=await l.PartnerModel.query().findOne({id:e});if(!r)throw new a.NotFoundException(`Partner with ID ${e} not found`);const o=await l.UserModel.query().findById(r.userId);if(!o)throw new a.NotFoundException(`User with ID ${r.userId} not found`);const i={roleId:1,role:{id:1,name:"partner"},integrationId:1,territoryId:1,salutation:o.salutation,nscBranchId:1,name:`${o.firstName} ${o.middleName||""} ${o.lastName}`.trim(),email:o.email,mobilePhone:o.mobilePhone,businessPhone:o.businessPhone,suffix:o.suffix,taxPayerId:o.taxPayerId,gender:o.gender,status:o.status,startDate:"2026-05-05T09:45:14.329Z",endDate:"2026-05-05T09:45:14.329Z",remark:o.remark},n=await l.UserAddressModel.query().where("userId",r.userId).where("addressType",u.AddressTypeEnum.Billing).orderBy("id","desc").first(),s=await l.UserAddressModel.query().where("userId",r.userId).where("addressType",u.AddressTypeEnum.Mailing).orderBy("id","desc").first();return{accountInformation:i,billingAddressInformation:n?{country:n.country,province:n.stateOrProvince,city:n.city,subDistrict:n.subDistrict,village:n.village,postalCode:n.zipOrPostalCode,street:n.street}:{},mailingAddressInformation:s?{country:s.country,province:s.stateOrProvince,city:s.city,subDistrict:s.subDistrict,village:s.village,postalCode:s.zipOrPostalCode,street:s.street}:{}}}async createPartner(e,t){const{accountInformation:r,billingAddressInformation:o,mailingAddressInformation:i}=e;await this.validateUniqueFieldsForCreate(r);const{firstName:n,middleName:s,lastName:a}=(0,c.splitName)(r.name),d={updatedBy:t.userId,createdBy:t.userId,updatedAt:new Date},p=await(0,y.genSalt)(10),f=await(0,y.hash)(e.accountInformation.password,p),g=await l.PartnerModel.startTransaction();try{const e=await l.UserModel.query(g).insert({firstName:n,middleName:s,lastName:a,businessPhone:r.businessPhone,mobilePhone:r.mobilePhone,gender:r.gender,status:!0,email:r.email,roleId:r.roleId,territoryId:r.territoryId,nscBranchId:r.nscBranchId,taxPayerId:r?.taxPayerId,salutation:r.salutation,suffix:r.suffix,remark:r.remark,...d}),t=await l.PartnerModel.query(g).insert({userId:e.id,password:f,...d});return await l.UserAddressModel.query(g).insert({userId:e.id,addressType:u.AddressTypeEnum.Billing,country:o?.country,stateOrProvince:o?.province,city:o?.city,subDistrict:o?.subDistrict,village:o?.village,zipOrPostalCode:o?.postalCode,street:o?.street}),await l.UserAddressModel.query(g).insert({userId:e.id,addressType:u.AddressTypeEnum.Mailing,country:i?.country,stateOrProvince:i?.province,city:i?.city,subDistrict:i?.subDistrict,village:i?.village,zipOrPostalCode:i?.postalCode,street:i?.street}),await g.commit(),t}catch(e){throw await g.rollback(),e}}async updatePartner(e,t,r){try{const o=await l.PartnerModel.query().findById(e);if(!o)throw new a.NotFoundException(`Partner with ID ${e} not found`);t.accountInformation&&await this.validateUniqueFieldsForUpdate(e,t.accountInformation);const i={updatedBy:r.userId,updatedAt:new Date},n=await l.PartnerModel.startTransaction();try{if(t.accountInformation){const e={...i};if(t.accountInformation.name){const{firstName:r,middleName:o,lastName:i}=(0,c.splitName)(t.accountInformation.name);r&&(e.firstName=r),o&&(e.middleName=o),i&&(e.lastName=i)}t.accountInformation.businessPhone&&(e.businessPhone=t.accountInformation.businessPhone),t.accountInformation.mobilePhone&&(e.mobilePhone=t.accountInformation.mobilePhone),t.accountInformation.gender&&(e.gender=t.accountInformation.gender),t.accountInformation.email&&(e.email=t.accountInformation.email),t.accountInformation.salutation&&(e.salutation=t.accountInformation.salutation),t.accountInformation.suffix&&(e.suffix=t.accountInformation.suffix),t.accountInformation.remark&&(e.remark=t.accountInformation.remark),void 0!==t.accountInformation.status&&(e.status=t.accountInformation.status),t.accountInformation.roleId&&(e.roleId=t.accountInformation.roleId),t.accountInformation.territoryId&&(e.territoryId=t.accountInformation.territoryId),t.accountInformation.nscBranchId&&(e.nscBranchId=t.accountInformation.nscBranchId),t.accountInformation.taxPayerId&&(e.taxPayerId=t.accountInformation.taxPayerId),await l.UserModel.query(n).findById(o.userId).patch(e)}if(t.billingAddressInformation){const e={...i};t.billingAddressInformation.country&&(e.country=t.billingAddressInformation.country),t.billingAddressInformation.province&&(e.stateOrProvince=t.billingAddressInformation.province),t.billingAddressInformation.city&&(e.city=t.billingAddressInformation.city),t.billingAddressInformation.subDistrict&&(e.subDistrict=t.billingAddressInformation.subDistrict),t.billingAddressInformation.village&&(e.village=t.billingAddressInformation.village),t.billingAddressInformation.postalCode&&(e.zipOrPostalCode=t.billingAddressInformation.postalCode),t.billingAddressInformation.street&&(e.street=t.billingAddressInformation.street),Object.keys(e).length>2&&await l.UserAddressModel.query(n).where("userId",o.userId).where("addressType",u.AddressTypeEnum.Billing).patch(e)}if(t.mailingAddressInformation){const e={...i};t.mailingAddressInformation.country&&(e.country=t.mailingAddressInformation.country),t.mailingAddressInformation.province&&(e.stateOrProvince=t.mailingAddressInformation.province),t.mailingAddressInformation.city&&(e.city=t.mailingAddressInformation.city),t.mailingAddressInformation.subDistrict&&(e.subDistrict=t.mailingAddressInformation.subDistrict),t.mailingAddressInformation.village&&(e.village=t.mailingAddressInformation.village),t.mailingAddressInformation.postalCode&&(e.zipOrPostalCode=t.mailingAddressInformation.postalCode),t.mailingAddressInformation.street&&(e.street=t.mailingAddressInformation.street),Object.keys(e).length>2&&await l.UserAddressModel.query(n).where("userId",o.userId).where("addressType",u.AddressTypeEnum.Mailing).patch(e)}await n.commit();return await l.PartnerModel.query().findById(e)}catch(e){throw await n.rollback(),e}}catch(e){throw e}}async deletePartner(e,t){const r=await l.PartnerModel.query().findOne({id:e,deletedAt:null});if(!r)throw new a.NotFoundException(`Partner with ID ${e} not found or has been deleted`);return r.deletedBy=t.userId,r.deletedAt=new Date,await r.$query().patch(),{message:`Partner with ID ${e} deleted successfully`,id:e}}};t.PartnerService=m,t.PartnerService=m=i([(0,a.Injectable)(),s(0,(0,a.Inject)(a.Logger)),s(0,(0,a.Optional)()),n("design:paramtypes",["function"==typeof(o=void 0!==a.LoggerService&&a.LoggerService)?o:Object])],m)},862:function(e,t,r){var o=this&&this.__decorate||function(e,t,r,o){var i,n=arguments.length,s=n<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(s=(n<3?i(s):n>3?i(t,r,s):i(t,r))||s);return n>3&&s&&Object.defineProperty(t,r,s),s};Object.defineProperty(t,"__esModule",{value:!0}),t.AssetModule=void 0;const i=r(1813),n=r(7127);let s=class{};t.AssetModule=s,t.AssetModule=s=o([(0,i.Module)({providers:[n.AssetService],exports:[n.AssetService]})],s)},872:function(e,t,r){var o=this&&this.__decorate||function(e,t,r,o){var i,n=arguments.length,s=n<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(s=(n<3?i(s):n>3?i(t,r,s):i(t,r))||s);return n>3&&s&&Object.defineProperty(t,r,s),s};Object.defineProperty(t,"__esModule",{value:!0}),t.WorkOrderModule=void 0;const i=r(1813),n=r(4873);let s=class{};t.WorkOrderModule=s,t.WorkOrderModule=s=o([(0,i.Module)({providers:[n.WorkOrderService],exports:[n.WorkOrderService]})],s)},900:function(e,t,r){var o,i=this&&this.__decorate||function(e,t,r,o){var i,n=arguments.length,s=n<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(s=(n<3?i(s):n>3?i(t,r,s):i(t,r))||s);return n>3&&s&&Object.defineProperty(t,r,s),s},n=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(t,"__esModule",{value:!0}),t.S3InitializerService=void 0;const s=r(1813),a=r(2057),l=r(8153);let c=class{constructor(e){this.s3Service=e,this.logger=new s.Logger("S3Initializer")}async onModuleInit(){this.logger.log("Testing S3/Linode Objects connection...");try{if(!this.s3Service.isConfigured())return void this.logger.warn("âš ï¸  S3 is not configured. Check your environment variables (BUCKET, END_POINT, ACCESS_KEY, SECRET)");const e=this.s3Service.getBucketName(),t=this.s3Service.getEndpoint();this.logger.log("ðŸ”— S3 Configuration Found:"),this.logger.log(`   Bucket: ${e}`),this.logger.log(`   Endpoint: ${t}`);try{await this.s3Service.getPresignedUrl("images.jpg",60)&&(this.logger.log("âœ… S3/Linode Objects Connection: SUCCESS"),this.logger.log("ðŸš€ Ready to handle file uploads"))}catch(e){this.logger.error(`âŒ S3 Connection Test Failed: ${e.message}`),this.logger.warn("âš ï¸  File uploads will fail. Please check your S3 credentials and configuration.")}await this.testPublicUrlAccess()}catch(e){this.logger.error(`âŒ S3 Initialization Error: ${e.message}`),this.logger.warn("âš ï¸  Application will continue running but S3 features may not work properly.")}}async testPublicUrlAccess(){try{const e=this.s3Service.getBucketName();if(!e)return void this.logger.warn("âš ï¸  Bucket name not available. Skipping public URL test.");const t=`https://${e}/images.jpg`;this.logger.log("ðŸ” Testing public URL access via bucket name..."),this.logger.log(`   Test URL: ${t}`);const r=await this.checkUrlStatus(t);200===r||404===r?(this.logger.log("âœ… Public URL access via bucket name: SUCCESS"),this.logger.log(`   HTTP Status: ${r}`),this.logger.log(`   URL Format: https://${e}/{key}`)):(this.logger.warn(`âš ï¸  Public URL returned HTTP ${r}`),this.logger.warn("   Check if bucket policy allows public access or file exists"))}catch(e){this.logger.warn(`âš ï¸  Public URL test failed: ${e.message}`),this.logger.warn("   This is expected if bucket name DNS is not configured or network is restricted"),this.logger.log("   S3 upload functionality will still work with presigned URLs")}}checkUrlStatus(e){return new Promise((t,r)=>{const o=new URL(e),i={hostname:o.hostname,port:443,path:o.pathname+o.search,method:"HEAD",timeout:5e3},n=a.request(i,e=>{t(e.statusCode||0)});n.on("error",e=>{r(e)}),n.on("timeout",()=>{n.destroy(),r(new Error("Request timeout"))}),n.end()})}};t.S3InitializerService=c,t.S3InitializerService=c=i([(0,s.Injectable)(),n("design:paramtypes",["function"==typeof(o=void 0!==l.S3Service&&l.S3Service)?o:Object])],c)},911:function(e,t,r){var o,i,n,s=this&&this.__decorate||function(e,t,r,o){var i,n=arguments.length,s=n<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(s=(n<3?i(s):n>3?i(t,r,s):i(t,r))||s);return n>3&&s&&Object.defineProperty(t,r,s),s},a=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},l=this&&this.__param||function(e,t){return function(r,o){t(r,o,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.AccessTokenGuard=void 0;const c=r(1813),d=r(7819),u=r(4602),p=r(9124),f=r(7175),g=r(4671),y=r(1514);let m=class extends((0,u.AuthGuard)("token")){constructor(e,t,r){super({property:"token"}),this.reflector=e,this.logger=r,r||(this.logger=new c.Logger("AuthLibrary")),this.allowedAppType=t.get("TOKEN_APP_TYPE_ALLOWED"),this.allowedAppType||this.logger.warn("No TOKEN_APP_TYPE_ALLOWED is set in the application. Any token will valid even it created from another app!")}getPermissions(e){return this.reflector.getAllAndOverride(p.PERMISSION_METADATA,[e.getHandler(),e.getClass()])}getPermissionsAsAccessObject(e){const t=this.getPermissions(e);return t?{[t.module]:[t.action]}:{}}canActivate(e){if("http"!=e.getType())return this.logger.verbose(`[Guard] not handling ${e.getType()}`),super.canActivate(e);return!1===this.getPermissions(e)||super.canActivate(e)}handleRequest(e,t,r,o){if(this.logger.verbose("[Guard] Token checking.."),r&&["JsonWebTokenError","TokenExpiredError"].includes(r.constructor?.name)){if("TokenExpiredError"==r.constructor.name)throw this.logger.verbose("[Guard] Token expired"),new f.AuthExpiredAccessTokenException;throw this.logger.verbose("[Guard] Token invalid",r),r}if(e)throw this.logger.verbose("[Guard] Token error",e),e;if(this.allowedAppType&&this.allowedAppType!==t.app)throw this.logger.warn("[Guard] Token app type miss match",t),new c.UnauthorizedException("Invalid app token type");const i=this.getPermissionsAsAccessObject(o);if(!t)throw this.logger.verbose("[Guard] Token not found"),new c.UnauthorizedException;let n,s;if(this.logger.verbose("[Guard] Token valid"),(0,g.checkAccess)(i,t.access)?s=i:n=(0,g.getMissingAccess)(i,t.access),!s)throw this.logger.verbose("[Guard] Blocked, missing permissions",n),new f.AuthForbiddenException(n);return this.logger.verbose("[Guard] Passed, permissions OK"),t}};t.AccessTokenGuard=m,t.AccessTokenGuard=m=s([(0,c.Injectable)(),l(2,(0,c.Optional)()),l(2,(0,c.Inject)(c.Logger)),a("design:paramtypes",["function"==typeof(o=void 0!==d.Reflector&&d.Reflector)?o:Object,"function"==typeof(i=void 0!==y.ConfigService&&y.ConfigService)?i:Object,"function"==typeof(n=void 0!==c.LoggerService&&c.LoggerService)?n:Object])],m)},919:(e,t)=>{var r;Object.defineProperty(t,"__esModule",{value:!0}),t.ManualInventoryRequestTypeEnum=void 0,function(e){e.None="None",e.Increase="Increase",e.Decrease="Decrease"}(r||(t.ManualInventoryRequestTypeEnum=r={}))},932:function(e,t,r){var o=this&&this.__createBinding||(Object.create?function(e,t,r,o){void 0===o&&(o=r);var i=Object.getOwnPropertyDescriptor(t,r);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,o,i)}:function(e,t,r,o){void 0===o&&(o=r),e[o]=t[r]}),i=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||o(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),i(r(5432),t),i(r(8659),t)},944:function(e,t,r){var o,i,n,s,a,l,c,d,u=this&&this.__decorate||function(e,t,r,o){var i,n=arguments.length,s=n<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(s=(n<3?i(s):n>3?i(t,r,s):i(t,r))||s);return n>3&&s&&Object.defineProperty(t,r,s),s},p=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(t,"__esModule",{value:!0}),t.UpdateCustomerDto=t.CreateCustomerDto=t.UpdateAccountInformationDto=t.AccountInformationDto=t.AddressDto=void 0;const f=r(6325),g=r(284),y=r(6088),m=r(5007),h=r(5635);class b{}t.AddressDto=b,u([(0,f.IsString)({message:"Country must be a string"}),(0,f.IsOptional)(),(0,g.Transform)(({value:e})=>(0,h.safeTrim)(e)),p("design:type",String)],b.prototype,"country",void 0),u([(0,f.IsString)({message:"Province must be a string"}),(0,f.IsOptional)(),(0,g.Transform)(({value:e})=>(0,h.safeTrim)(e)),p("design:type",String)],b.prototype,"province",void 0),u([(0,f.IsString)({message:"City must be a string"}),(0,f.IsOptional)(),(0,g.Transform)(({value:e})=>(0,h.safeTrim)(e)),p("design:type",String)],b.prototype,"city",void 0),u([(0,f.IsString)({message:"Sub-district must be a string"}),(0,f.IsOptional)(),(0,g.Transform)(({value:e})=>(0,h.safeTrim)(e)),p("design:type",String)],b.prototype,"subDistrict",void 0),u([(0,f.IsString)({message:"Village must be a string"}),(0,f.IsOptional)(),(0,g.Transform)(({value:e})=>(0,h.safeTrim)(e)),p("design:type",String)],b.prototype,"village",void 0),u([(0,f.IsInt)({message:"Postal code must be a string"}),(0,f.IsOptional)(),p("design:type",Number)],b.prototype,"postalCode",void 0),u([(0,f.IsString)({message:"Street must be a string"}),(0,f.IsOptional)(),(0,g.Transform)(({value:e})=>(0,h.safeTrim)(e)),p("design:type",String)],b.prototype,"street",void 0);class v{}t.AccountInformationDto=v,u([(0,f.IsString)({message:"name must be a string"}),(0,f.IsNotEmpty)({message:"name should not be empty"}),(0,g.Transform)(({value:e})=>(0,h.safeTrim)(e)),p("design:type",String)],v.prototype,"name",void 0),u([(0,f.IsEnum)(y.SalutationEnum,{message:"salutation must be a valid enum value"}),p("design:type","function"==typeof(o=void 0!==y.SalutationEnum&&y.SalutationEnum)?o:Object)],v.prototype,"salutation",void 0),u([(0,f.IsEmail)({},{message:"email must be a valid email address"}),(0,g.Transform)(({value:e})=>(0,h.safeTrim)(e)),p("design:type",String)],v.prototype,"email",void 0),u([(0,f.IsAlphanumeric)(),(0,f.Length)(8,15,{message:"businessPhone must be between 8 and 15 characters long"}),(0,f.IsOptional)(),p("design:type",String)],v.prototype,"businessPhone",void 0),u([(0,f.IsAlphanumeric)(),(0,f.Length)(8,15,{message:"mobilePhone must be between 8 and 15 characters long"}),(0,f.IsNotEmpty)({message:"mobilePhone should not be empty"}),p("design:type",String)],v.prototype,"mobilePhone",void 0),u([(0,f.IsString)({message:"suffix must be a string"}),(0,f.IsOptional)(),(0,g.Transform)(({value:e})=>(0,h.safeTrim)(e)),p("design:type",String)],v.prototype,"suffix",void 0),u([(0,f.IsEnum)(y.GenderEnum,{message:"gender must be a valid enum value"}),p("design:type","function"==typeof(i=void 0!==y.GenderEnum&&y.GenderEnum)?i:Object)],v.prototype,"gender",void 0),u([(0,f.IsBoolean)({message:"status must be a boolean"}),p("design:type",Boolean)],v.prototype,"status",void 0),u([(0,f.IsEnum)(y.MembershipTypeEnum,{message:"membershipType must be a valid enum value"}),p("design:type","function"==typeof(n=void 0!==y.MembershipTypeEnum&&y.MembershipTypeEnum)?n:Object)],v.prototype,"membershipType",void 0),u([(0,f.IsString)({message:"remark must be a string"}),(0,f.IsOptional)(),(0,g.Transform)(({value:e})=>(0,h.safeTrim)(e)),p("design:type",String)],v.prototype,"remark",void 0);class O extends((0,m.PartialType)(v)){}t.UpdateAccountInformationDto=O;class P{}t.CreateCustomerDto=P,u([(0,f.IsString)({message:"name must be a string"}),(0,f.IsNotEmpty)({message:"name should not be empty"}),(0,g.Transform)(({value:e})=>(0,h.safeTrim)(e)),p("design:type",String)],P.prototype,"name",void 0),u([(0,f.IsEnum)(y.SalutationEnum,{message:"salutation must be a valid enum value"}),(0,g.Transform)(({value:e})=>(0,h.safeTrim)(e)),p("design:type","function"==typeof(s=void 0!==y.SalutationEnum&&y.SalutationEnum)?s:Object)],P.prototype,"salutation",void 0),u([(0,f.IsEmail)({},{message:"email must be a valid email address"}),(0,g.Transform)(({value:e})=>(0,h.safeTrim)(e)),p("design:type",String)],P.prototype,"email",void 0),u([(0,f.IsAlphanumeric)(),(0,f.Length)(8,15,{message:"businessPhone must be between 8 and 15 characters long"}),(0,f.IsOptional)(),(0,g.Transform)(({value:e})=>(0,h.safeTrim)(e)),p("design:type",String)],P.prototype,"businessPhone",void 0),u([(0,f.IsAlphanumeric)(),(0,f.Length)(8,15,{message:"mobilePhone must be between 8 and 15 characters long"}),(0,f.IsNotEmpty)({message:"mobilePhone should not be empty"}),(0,g.Transform)(({value:e})=>(0,h.safeTrim)(e)),p("design:type",String)],P.prototype,"mobilePhone",void 0),u([(0,f.IsString)({message:"suffix must be a string"}),(0,f.IsOptional)(),(0,g.Transform)(({value:e})=>(0,h.safeTrim)(e)),p("design:type",String)],P.prototype,"suffix",void 0),u([(0,f.IsEnum)(y.GenderEnum,{message:"gender must be a valid enum value"}),(0,g.Transform)(({value:e})=>(0,h.safeTrim)(e)),p("design:type","function"==typeof(a=void 0!==y.GenderEnum&&y.GenderEnum)?a:Object)],P.prototype,"gender",void 0),u([(0,f.IsBoolean)({message:"status must be a boolean"}),(0,g.Transform)(({value:e})=>"boolean"==typeof e?e:"true"===e||!0===e||1===e||"1"===e),p("design:type",Boolean)],P.prototype,"status",void 0),u([(0,f.IsEnum)(y.MembershipTypeEnum,{message:"membershipType must be a valid enum value"}),(0,g.Transform)(({value:e})=>(0,h.safeTrim)(e)),p("design:type","function"==typeof(l=void 0!==y.MembershipTypeEnum&&y.MembershipTypeEnum)?l:Object)],P.prototype,"membershipType",void 0),u([(0,f.IsString)({message:"remark must be a string"}),(0,f.IsOptional)(),(0,g.Transform)(({value:e})=>(0,h.safeTrim)(e)),p("design:type",String)],P.prototype,"remark",void 0),u([(0,f.IsString)({message:"Billing country must be a string"}),(0,f.IsOptional)(),(0,g.Transform)(({value:e})=>(0,h.safeTrim)(e)),p("design:type",String)],P.prototype,"billingCountry",void 0),u([(0,f.IsString)({message:"Billing province must be a string"}),(0,f.IsOptional)(),(0,g.Transform)(({value:e})=>(0,h.safeTrim)(e)),p("design:type",String)],P.prototype,"billingProvince",void 0),u([(0,f.IsString)({message:"Billing city must be a string"}),(0,f.IsOptional)(),(0,g.Transform)(({value:e})=>(0,h.safeTrim)(e)),p("design:type",String)],P.prototype,"billingCity",void 0),u([(0,f.IsString)({message:"Billing sub-district must be a string"}),(0,f.IsOptional)(),(0,g.Transform)(({value:e})=>(0,h.safeTrim)(e)),p("design:type",String)],P.prototype,"billingSubDistrict",void 0),u([(0,f.IsString)({message:"Billing village must be a string"}),(0,f.IsOptional)(),(0,g.Transform)(({value:e})=>(0,h.safeTrim)(e)),p("design:type",String)],P.prototype,"billingVillage",void 0),u([(0,f.IsInt)({message:"Billing postal code must be a number"}),(0,f.IsOptional)(),(0,g.Transform)(({value:e})=>{if(null!=e)return"number"==typeof e?e:parseInt(e,10)}),p("design:type",Number)],P.prototype,"billingPostalCode",void 0),u([(0,f.IsString)({message:"Billing street must be a string"}),(0,f.IsOptional)(),(0,g.Transform)(({value:e})=>(0,h.safeTrim)(e)),p("design:type",String)],P.prototype,"billingStreet",void 0),u([(0,f.IsString)({message:"Mailing country must be a string"}),(0,f.IsOptional)(),(0,g.Transform)(({value:e})=>(0,h.safeTrim)(e)),p("design:type",String)],P.prototype,"mailingCountry",void 0),u([(0,f.IsString)({message:"Mailing province must be a string"}),(0,f.IsOptional)(),(0,g.Transform)(({value:e})=>(0,h.safeTrim)(e)),p("design:type",String)],P.prototype,"mailingProvince",void 0),u([(0,f.IsString)({message:"Mailing city must be a string"}),(0,f.IsOptional)(),(0,g.Transform)(({value:e})=>(0,h.safeTrim)(e)),p("design:type",String)],P.prototype,"mailingCity",void 0),u([(0,f.IsString)({message:"Mailing sub-district must be a string"}),(0,f.IsOptional)(),(0,g.Transform)(({value:e})=>(0,h.safeTrim)(e)),p("design:type",String)],P.prototype,"mailingSubDistrict",void 0),u([(0,f.IsString)({message:"Mailing village must be a string"}),(0,f.IsOptional)(),(0,g.Transform)(({value:e})=>(0,h.safeTrim)(e)),p("design:type",String)],P.prototype,"mailingVillage",void 0),u([(0,f.IsInt)({message:"Mailing postal code must be a number"}),(0,f.IsOptional)(),(0,g.Transform)(({value:e})=>{if(null!=e)return"number"==typeof e?e:parseInt(e,10)}),p("design:type",Number)],P.prototype,"mailingPostalCode",void 0),u([(0,f.IsString)({message:"Mailing street must be a string"}),(0,f.IsOptional)(),(0,g.Transform)(({value:e})=>(0,h.safeTrim)(e)),p("design:type",String)],P.prototype,"mailingStreet",void 0),u([(0,f.IsOptional)(),p("design:type","function"==typeof(d="undefined"!=typeof Express&&void 0!==(c=Express.Multer)&&c.File)?d:Object)],P.prototype,"profilePicture",void 0);class _ extends((0,m.PartialType)(P)){}t.UpdateCustomerDto=_},945:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0});const o=r(7861),i=r(7729);class n extends o.Model{}n.tableName=i.constants.TableName.Customers,n.idColumn="id",t.default=n},1187:function(e,t,r){var o=this&&this.__decorate||function(e,t,r,o){var i,n=arguments.length,s=n<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(s=(n<3?i(s):n>3?i(t,r,s):i(t,r))||s);return n>3&&s&&Object.defineProperty(t,r,s),s};Object.defineProperty(t,"__esModule",{value:!0}),t.GetAllWorkOrderUseCase=void 0;const i=r(1813),n=r(6245);let s=class{async execute(){return await this.getData(),this.data}async getData(){this.data=await n.WorkOrderModel.query().withGraphJoined("[customer(selectCustomer), status(selectStatus)]").whereNull("deletedAt").modifiers({selectCustomer(e){e.select("id","firstName","middleName","lastName")},selectStatus(e){e.select("id","name")}})}};t.GetAllWorkOrderUseCase=s,t.GetAllWorkOrderUseCase=s=o([(0,i.Injectable)()],s)},1193:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.TableName=void 0,t.TableName={Customers:"Customers",Permissions:"Permissions",Modules:"Modules",Menus:"Menus",Roles:"Roles",Technicians:"Technicians",Partners:"Partners",UserAdresses:"UserAdresses",UserAddresses:"UserAddresses",Users:"Users",WorkOrders:"WorkOrders",WorkOrderStatus:"WorkOrderStatus",WorkOrderSubStatus:"WorkOrderSubStatus",WorkOrderJobReason:"WorkOrderJobReason",Claims:"Claims",Charges:"Charges",IrisCodes:"IrisCodes",Models:"Models",Products:"Products",Dealers:"Dealers",Warranties:"Warranties",Assets:"Assets",Invoices:"Invoices"}},1206:function(e,t,r){var o=this&&this.__createBinding||(Object.create?function(e,t,r,o){void 0===o&&(o=r);var i=Object.getOwnPropertyDescriptor(t,r);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,o,i)}:function(e,t,r,o){void 0===o&&(o=r),e[o]=t[r]}),i=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||o(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),i(r(2047),t),i(r(5947),t),i(r(3037),t),i(r(5877),t),i(r(107),t),i(r(2717),t),i(r(7578),t),i(r(2585),t),i(r(4626),t),i(r(6077),t),i(r(274),t),i(r(5306),t),i(r(8109),t),i(r(1879),t),i(r(4246),t),i(r(5536),t),i(r(1850),t),i(r(3856),t),i(r(113),t),i(r(4339),t),i(r(4724),t)},1212:function(e,t,r){var o=this&&this.__createBinding||(Object.create?function(e,t,r,o){void 0===o&&(o=r);var i=Object.getOwnPropertyDescriptor(t,r);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,o,i)}:function(e,t,r,o){void 0===o&&(o=r),e[o]=t[r]}),i=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||o(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),i(r(4424),t),i(r(6329),t)},1227:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.randomStrings=function(e=""){const t=Buffer.alloc(4);return t.writeInt32LE(Date.now()/1e3),e+Buffer.concat([t,(0,o.randomBytes)(11)],15).toString("hex").toUpperCase()},t.safeTrim=function(e){return"string"==typeof e?e.trim():e};const o=r(7598)},1284:function(e,t,r){var o=this&&this.__decorate||function(e,t,r,o){var i,n=arguments.length,s=n<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(s=(n<3?i(s):n>3?i(t,r,s):i(t,r))||s);return n>3&&s&&Object.defineProperty(t,r,s),s};Object.defineProperty(t,"__esModule",{value:!0}),t.SampleModule=void 0;const i=r(1813),n=r(2213);let s=class{};t.SampleModule=s,t.SampleModule=s=o([(0,i.Module)({providers:[n.SampleService],exports:[n.SampleService]})],s)},1321:e=>{e.exports=require("reflect-metadata")},1350:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0});const o=r(7861),i=r(8239);class n extends o.Model{}n.tableName=i.TableName.Models,t.default=n},1357:function(e,t,r){var o,i=this&&this.__decorate||function(e,t,r,o){var i,n=arguments.length,s=n<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(s=(n<3?i(s):n>3?i(t,r,s):i(t,r))||s);return n>3&&s&&Object.defineProperty(t,r,s),s},n=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},s=this&&this.__param||function(e,t){return function(r,o){t(r,o,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.AccessTokenStrategy=void 0;const a=r(9200),l=r(4602),c=r(1813),d=r(6661),u=r(5096),p=r(9124),f=r(1944),g=r(7729);let y=class extends((0,l.PassportStrategy)(a.Strategy,"token")){constructor(e){super({jwtFromRequest:a.ExtractJwt.fromExtractors([a.ExtractJwt.fromAuthHeaderAsBearerToken(),e=>{const t=e.cookies||e.headers?.cookie&&u.parse(e.headers?.cookie);return t&&t.token||null},e=>e.query?.token||null]),ignoreExpiration:!1,secretOrKey:e.publicKey||e.secret,algorithms:e.signOptions?.algorithm?[e.signOptions.algorithm]:["HS256"]})}async validate(e){if(!e||"object"!=typeof e||!("userId"in e))return Promise.reject(new c.BadRequestException("Invalid token"));const t=await f.UserModel.query().findById(e.userId).first();if(!t)return Promise.reject(new c.UnauthorizedException(`User id ${e.userId} not found`));const r=await f.RoleModel.query().select("id","permissions","name","slug").findById(t.roleId).first();if(!r)return Promise.reject(new c.UnauthorizedException("Invalid role id"));const o={};return(await f.PermissionModel.query().select(`${g.constants.TableName.Permissions}.id`,`${g.constants.TableName.Permissions}.slug`,`${g.constants.TableName.Modules}.slug as moduleSlug`).join(g.constants.TableName.Modules,`${g.constants.TableName.Permissions}.moduleId`,`${g.constants.TableName.Modules}.id`).whereIn(`${g.constants.TableName.Permissions}.id`,r.permissions)).forEach(e=>{const{moduleSlug:t,slug:r}=e;t in o||(o[t]=[]),o[t].push(r)}),{userId:e.userId,app:e.app,role:{id:r.id,name:r.name,slug:r.slug},user:t,access:o,createdAt:new Date(1e3*e.iat),expiredAt:new Date(1e3*e.exp)}}};t.AccessTokenStrategy=y,t.AccessTokenStrategy=y=i([(0,c.Injectable)(),s(0,(0,c.Inject)(p.JWT_MODULE_OPTIONS)),n("design:paramtypes",["function"==typeof(o=void 0!==d.JwtModuleOptions&&d.JwtModuleOptions)?o:Object])],y)},1409:(e,t)=>{var r;Object.defineProperty(t,"__esModule",{value:!0}),t.SalutationEnum=void 0,function(e){e.None="None",e.Mr="Mr.",e.Ms="Ms.",e.Mrs="Mrs.",e.Dr="Dr.",e.Prof="Prof."}(r||(t.SalutationEnum=r={}))},1495:function(e,t,r){var o,i,n,s=this&&this.__decorate||function(e,t,r,o){var i,n=arguments.length,s=n<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(s=(n<3?i(s):n>3?i(t,r,s):i(t,r))||s);return n>3&&s&&Object.defineProperty(t,r,s),s},a=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(t,"__esModule",{value:!0}),t.FilterObjectNullDto=t.FilterObjectInDto=t.FilterObjectBetweenDto=t.FilterObjectLessGreaterDto=t.FilterObjectLikeDto=t.FilterObjectEqualityDto=t.FilterObjectDto=t.PaginationFilterAndDto=t.PaginationFilterOrDto=void 0;const l=r(284),c=r(6325),d=r(7621),u=r(1916);t.PaginationFilterOrDto=class extends Array{};class p extends Map{toJSON(){return Object.fromEntries(this.entries())}}t.PaginationFilterAndDto=p;class f{}t.FilterObjectDto=f,s([(0,c.IsEnum)(d.FilterOperator),a("design:type","function"==typeof(o=void 0!==d.FilterOperatorName&&d.FilterOperatorName)?o:Object)],f.prototype,"op",void 0),s([(0,l.Type)(()=>String,{discriminator:{property:"op",subTypes:[{name:"between",value:Array},{name:"in",value:Array},{name:"notIn",value:Array}]},keepDiscriminatorProperty:!0}),a("design:type",Object)],f.prototype,"value",void 0);class g extends f{}t.FilterObjectEqualityDto=g,s([(0,c.IsIn)([d.FilterOperator.equal,d.FilterOperator.notEqual]),a("design:type",Object)],g.prototype,"op",void 0),s([(0,u.IsOneOfNative)(["string","number"]),a("design:type",Object)],g.prototype,"value",void 0);class y extends f{}t.FilterObjectLikeDto=y,s([(0,c.Equals)(d.FilterOperator.like),a("design:type","function"==typeof(i=void 0!==d.FilterOperator&&d.FilterOperator.like)?i:Object)],y.prototype,"op",void 0),s([(0,c.IsString)(),a("design:type",String)],y.prototype,"value",void 0);class m extends f{}t.FilterObjectLessGreaterDto=m,s([(0,c.IsIn)([d.FilterOperator.lessThan,d.FilterOperator.greaterThan]),a("design:type",Object)],m.prototype,"op",void 0),s([(0,u.IsOneOfNative)(["string","number"]),a("design:type",Object)],m.prototype,"value",void 0);class h extends f{}t.FilterObjectBetweenDto=h,s([(0,c.Equals)(d.FilterOperator.between),a("design:type","function"==typeof(n=void 0!==d.FilterOperator&&d.FilterOperator.between)?n:Object)],h.prototype,"op",void 0),s([(0,u.IsOneOfNative)(["string","number"],{each:!0}),(0,c.IsArray)(),(0,u.IsBetweenFilter)(),a("design:type",Array)],h.prototype,"value",void 0);class b extends f{}t.FilterObjectInDto=b,s([(0,c.IsIn)([d.FilterOperator.in,d.FilterOperator.notIn]),a("design:type",Object)],b.prototype,"op",void 0),s([(0,c.IsArray)(),(0,c.IsNotEmpty)(),(0,c.ArrayMinSize)(1),(0,c.ArrayMaxSize)(20),(0,u.IsOneOfNative)(["string","number"],{each:!0}),a("design:type",Array)],b.prototype,"value",void 0);class v extends f{}t.FilterObjectNullDto=v,s([(0,c.IsIn)([d.FilterOperator.isNull,d.FilterOperator.isNotNull]),a("design:type",Object)],v.prototype,"op",void 0),s([(0,c.Equals)(void 0,{message:"$property isNull/isNotNull cannot have value"}),a("design:type",void 0)],v.prototype,"value",void 0)},1514:e=>{e.exports=require("@nestjs/config")},1599:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0});const o=r(7861),i=r(7729);class n extends o.Model{}n.tableName=i.constants.TableName.Claims,n.idColumn="id",n.jsonSchema={type:"object",required:["id","claimNumber","woId","claimStatus","claimAmount"],properties:{id:{type:"integer"},claimNumber:{type:"string"},woId:{type:"integer"},claimStatus:{type:"string"},claimAmount:{type:"number"},createdAt:{type:"string"},createdBy:{type:"integer"}}},t.default=n},1606:(e,t)=>{var r;Object.defineProperty(t,"__esModule",{value:!0}),t.AddressTypeEnum=void 0,function(e){e.Billing="billing",e.Shipping="shipping",e.Mailing="mailing"}(r||(t.AddressTypeEnum=r={}))},1706:(e,t)=>{function r(e,t){return e&&t&&0!==t.length?t.map(t=>({[t]:e})):[]}Object.defineProperty(t,"__esModule",{value:!0}),t.expandSearchFilter=r,t.processSearchFilterWithColumns=function(e,t){if(e instanceof Map){if(!e.has("search"))return e;const o={},i=new Map(e),n=i.get("search");i.delete("search");const s=r(n,t);return o._searchGroup=s,i.forEach((e,t)=>{o[t]=e}),o}if(Array.isArray(e)){const o=[];return e.forEach(e=>{if(e instanceof Map&&e.has("search")){const i=e.get("search"),n={},s=r(i,t);n._searchGroup=s;const a=new Map(e);a.delete("search"),a.forEach((e,t)=>{n[t]=e}),o.push(n)}else o.push(e)}),o.length>0?o:e}return e}},1712:e=>{e.exports=require("bcrypt")},1714:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0});const o=r(7861),i=r(7729);class n extends o.Model{}n.tableName=i.constants.TableName.IrisCodes,n.idColumn="id",n.jsonSchema={type:"object",required:["id"],properties:{id:{type:"integer"},conditionCode:{type:"string"},conditionDetail:{type:"string"},symptomGroup:{type:"string"},symptomGroup2:{type:"string"},symptomCode:{type:"string"},symptomDetail:{type:"string"},defectCode:{type:"string"},defectDetail:{type:"string"},repairCode:{type:"string"},repairDetail:{type:"string"},technicalRemark:{type:"string"},productCondition:{type:"string"},specialInstructionsToPartAdmin:{type:"string"},createdAt:{type:"string"},createdBy:{type:"integer"}}},t.default=n},1770:(e,t)=>{var r;Object.defineProperty(t,"__esModule",{value:!0}),t.WorkOrderDeliveryMethodEnum=void 0,function(e){e.None="None",e.Delivery="Delivery",e.SelfCollect="Self-collect"}(r||(t.WorkOrderDeliveryMethodEnum=r={}))},1813:e=>{e.exports=require("@nestjs/common")},1850:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0})},1879:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0})},1916:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.IsSingleKeyObjectWithEnum=function(e=n.PaginationSortOrder,t){return(0,i.ValidateBy)({name:"isSingleKeyObjectWithEnum",constraints:[e],validator:{validate(e,t){if(!(0,o.isPlainObject)(e))return!1;const r=Object.getOwnPropertyNames(e);return!(r.length>1)&&(0,i.isEnum)(e[r[0]],t.constraints[0])},defaultMessage:(0,i.buildMessage)(e=>e+"$property must be single-keyed object with valid enum value",t)}},t)},t.IsBetweenFilter=function(e){return(0,i.ValidateBy)({name:"isBetweenFilter",validator:{validate:e=>Array.isArray(e)&&2==e.length&&("string"==typeof e[0]&&"string"==typeof e[1]||"number"==typeof e[0]&&"number"==typeof e[1]),defaultMessage:(0,i.buildMessage)(e=>e+"$property must be valid between value [string, string] or [number, number]",e)}},e)},t.IsOneOf=function(e,t){return(0,i.ValidateBy)({name:"isOneOf",validator:{validate:t=>!!e.find(e=>t instanceof e),defaultMessage:({value:t})=>`${typeof t} is not in [${e.map(e=>e.name).join(", ")}]`}},t)},t.IsOneOfNative=function(e,t){return(0,i.ValidateBy)({name:"isOneOfNative",validator:{validate:t=>e.includes(typeof t),defaultMessage:({value:t})=>`Current type ${typeof t} is not in [${e.join(", ")}]`}},t)};const o=r(7546),i=r(6325),n=r(7621)},1944:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.InvoiceModel=t.AssetModel=t.WarrantyModel=t.DealerModel=t.ModelModel=t.ProductModel=t.ChargeModel=t.IrisModel=t.ClaimModel=t.CustomerModel=t.PermissionModel=t.ModuleModel=t.MenuModel=t.RoleModel=t.TechnicianModel=t.PartnerModel=t.UserAddressModel=t.UserModel=void 0;var o=r(8347);Object.defineProperty(t,"UserModel",{enumerable:!0,get:function(){return o.default}});var i=r(5323);Object.defineProperty(t,"UserAddressModel",{enumerable:!0,get:function(){return i.default}});var n=r(33);Object.defineProperty(t,"PartnerModel",{enumerable:!0,get:function(){return n.default}});var s=r(3171);Object.defineProperty(t,"TechnicianModel",{enumerable:!0,get:function(){return s.default}});var a=r(9857);Object.defineProperty(t,"RoleModel",{enumerable:!0,get:function(){return a.default}});var l=r(410);Object.defineProperty(t,"MenuModel",{enumerable:!0,get:function(){return l.default}});var c=r(4745);Object.defineProperty(t,"ModuleModel",{enumerable:!0,get:function(){return c.default}});var d=r(138);Object.defineProperty(t,"PermissionModel",{enumerable:!0,get:function(){return d.default}});var u=r(945);Object.defineProperty(t,"CustomerModel",{enumerable:!0,get:function(){return u.default}});var p=r(1599);Object.defineProperty(t,"ClaimModel",{enumerable:!0,get:function(){return p.default}});var f=r(1714);Object.defineProperty(t,"IrisModel",{enumerable:!0,get:function(){return f.default}});var g=r(9709);Object.defineProperty(t,"ChargeModel",{enumerable:!0,get:function(){return g.default}});var y=r(4808);Object.defineProperty(t,"ProductModel",{enumerable:!0,get:function(){return y.default}});var m=r(1350);Object.defineProperty(t,"ModelModel",{enumerable:!0,get:function(){return m.default}});var h=r(4588);Object.defineProperty(t,"DealerModel",{enumerable:!0,get:function(){return h.default}});var b=r(6341);Object.defineProperty(t,"WarrantyModel",{enumerable:!0,get:function(){return b.default}});var v=r(2391);Object.defineProperty(t,"AssetModel",{enumerable:!0,get:function(){return v.default}});var O=r(5e3);Object.defineProperty(t,"InvoiceModel",{enumerable:!0,get:function(){return O.default}})},1960:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0})},2047:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0})},2057:e=>{e.exports=require("https")},2067:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.SampleModel=void 0;const o=r(7861);class i extends o.Model{static get jsonSchema(){return{type:"object",required:["name","batch"],properties:{id:{type:"integer"},name:{type:"string"},batch:{type:"integer"},migration_time:{type:"string",format:"date-time"}}}}}t.SampleModel=i,i.tableName="knex_migrations",i.idColumn="id"},2087:function(e,t,r){var o,i=this&&this.__decorate||function(e,t,r,o){var i,n=arguments.length,s=n<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(s=(n<3?i(s):n>3?i(t,r,s):i(t,r))||s);return n>3&&s&&Object.defineProperty(t,r,s),s},n=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(t,"__esModule",{value:!0}),t.OtpService=void 0;const s=r(1813),a=r(8749),l=r(4754),c=r(1514);let d=class{constructor(e){this.expiresInMs=l(e.get("OTP_EXPIRES_IN","5m")),this.maxAttempts=parseInt(e.get("OTP_MAX_ATTEMPTS","5")),isNaN(this.maxAttempts)&&(this.maxAttempts=5),isNaN(this.expiresInMs)&&(this.expiresInMs=3e5)}generateOtpCode(){return((0,a.randomBytes)(3).readUIntBE(0,3)%1e6).toString().padStart(6,"0")}generateOtp(e){let t;if(void 0===e)t=this.expiresInMs;else if("number"==typeof e)t=1e3*e;else{if("string"!=typeof e)throw new s.BadRequestException("Invalid expiresIn format");t=l(e)}const r=this.generateOtpCode(),o=new Date(Date.now()+t);new Date;return{otpCode:r,otpExpiredAt:o}}verifyOtp(e,t,r=5){if(!e.otpCode)throw new s.BadRequestException("OTP code is required");if(!e.email&&!e.phone)throw new s.BadRequestException("Email or phone is required for verification");if(!t)throw new s.BadRequestException("OTP not found");if(new Date>t.otpExpiredAt)throw new s.BadRequestException("OTP has expired");if(t.otpCode!==e.otpCode)throw new s.BadRequestException("Invalid OTP code")}};t.OtpService=d,t.OtpService=d=i([(0,s.Injectable)(),n("design:paramtypes",["function"==typeof(o=void 0!==c.ConfigService&&c.ConfigService)?o:Object])],d)},2152:function(e,t,r){var o=this&&this.__decorate||function(e,t,r,o){var i,n=arguments.length,s=n<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(s=(n<3?i(s):n>3?i(t,r,s):i(t,r))||s);return n>3&&s&&Object.defineProperty(t,r,s),s};Object.defineProperty(t,"__esModule",{value:!0}),t.CustomerModule=void 0;const i=r(1813),n=r(5033),s=r(5364);let a=class{};t.CustomerModule=a,t.CustomerModule=a=o([(0,i.Module)({imports:[s.S3Module],providers:[n.CustomerService],exports:[n.CustomerService]})],a)},2178:function(e,t,r){var o=this&&this.__decorate||function(e,t,r,o){var i,n=arguments.length,s=n<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(s=(n<3?i(s):n>3?i(t,r,s):i(t,r))||s);return n>3&&s&&Object.defineProperty(t,r,s),s};Object.defineProperty(t,"__esModule",{value:!0}),t.UpdateWorkOrderUseCase=void 0;const i=r(1813),n=r(6245);let s=class{async execute(e){return this.params=e,await this.updateData(),this.result}async updateData(){if(!await n.WorkOrderModel.query().findById(this.params.id))throw new Error("Work order not found");await n.WorkOrderModel.query().findById(this.params.id).patch({...this.params.data,updatedBy:this.params.token.userId,updatedAt:new Date}),this.result=await n.WorkOrderModel.query().findById(this.params.id)}};t.UpdateWorkOrderUseCase=s,t.UpdateWorkOrderUseCase=s=o([(0,i.Injectable)()],s)},2202:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.knex=void 0,t.knex=r(4413)},2213:function(e,t,r){var o=this&&this.__decorate||function(e,t,r,o){var i,n=arguments.length,s=n<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(s=(n<3?i(s):n>3?i(t,r,s):i(t,r))||s);return n>3&&s&&Object.defineProperty(t,r,s),s},i=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(t,"__esModule",{value:!0}),t.SampleService=void 0;const n=r(1813),s=r(2067);let a=class{constructor(){}async getMigrationHistory(){return await s.SampleModel.query().orderBy("migration_time","desc").limit(5)}async getLastBatchNo(){return await s.SampleModel.query().max("batch as maxBatch").first()}};t.SampleService=a,t.SampleService=a=o([(0,n.Injectable)(),i("design:paramtypes",[])],a)},2386:function(e,t,r){var o=this&&this.__decorate||function(e,t,r,o){var i,n=arguments.length,s=n<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(s=(n<3?i(s):n>3?i(t,r,s):i(t,r))||s);return n>3&&s&&Object.defineProperty(t,r,s),s};Object.defineProperty(t,"__esModule",{value:!0}),t.UserModule=void 0;const i=r(1813),n=r(3147);let s=class{};t.UserModule=s,t.UserModule=s=o([(0,i.Module)({providers:[n.UserService],exports:[n.UserService]})],s)},2391:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0});const o=r(7861),i=r(4808),n=r(1350),s=r(6341),a=r(8239);class l extends o.Model{static get relationMappings(){return{product:{relation:o.Model.BelongsToOneRelation,modelClass:i.default,join:{from:`${a.TableName.Assets}.productId`,to:`${a.TableName.Products}.id`}},model:{relation:o.Model.BelongsToOneRelation,modelClass:n.default,join:{from:`${a.TableName.Assets}.modelId`,to:`${a.TableName.Models}.id`}},warranty:{relation:o.Model.BelongsToOneRelation,modelClass:s.default,join:{from:`${a.TableName.Assets}.warantyId`,to:`${a.TableName.Warranties}.id`}},parent:{relation:o.Model.BelongsToOneRelation,modelClass:l,join:{from:`${a.TableName.Assets}.parentAssetId`,to:`${a.TableName.Assets}.id`}},children:{relation:o.Model.HasManyRelation,modelClass:l,join:{from:`${a.TableName.Assets}.id`,to:`${a.TableName.Assets}.parentAssetId`}}}}}l.tableName=a.TableName.Assets,t.default=l},2459:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0})},2490:function(e,t,r){var o=this&&this.__createBinding||(Object.create?function(e,t,r,o){void 0===o&&(o=r);var i=Object.getOwnPropertyDescriptor(t,r);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,o,i)}:function(e,t,r,o){void 0===o&&(o=r),e[o]=t[r]}),i=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||o(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),i(r(7652),t),i(r(4773),t),i(r(9144),t)},2520:e=>{e.exports=require("@nestjs/swagger")},2526:function(e,t,r){var o=this&&this.__decorate||function(e,t,r,o){var i,n=arguments.length,s=n<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(s=(n<3?i(s):n>3?i(t,r,s):i(t,r))||s);return n>3&&s&&Object.defineProperty(t,r,s),s};Object.defineProperty(t,"__esModule",{value:!0}),t.ModelModule=void 0;const i=r(1813),n=r(5063);let s=class{};t.ModelModule=s,t.ModelModule=s=o([(0,i.Module)({providers:[n.ModelService],exports:[n.ModelService]})],s)},2563:function(e,t,r){var o,i=this&&this.__decorate||function(e,t,r,o){var i,n=arguments.length,s=n<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(s=(n<3?i(s):n>3?i(t,r,s):i(t,r))||s);return n>3&&s&&Object.defineProperty(t,r,s),s},n=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},s=this&&this.__param||function(e,t){return function(r,o){t(r,o,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.DealerService=void 0;const a=r(1813),l=r(1944),c=r(4014),d=r(4413);let u=class{constructor(e){this.logger=e,this.DEALER_SEARCH_COLUMNS=["name","email","mobilePhone"],e||(this.logger=new a.Logger("DealerService"))}async create(e){try{const t=await l.DealerModel.query().insert(e);return this.logger.log(`Dealer created with id: ${t.id}`),t}catch(e){throw this.logger.error(`Error creating dealer: ${e.message}`),e}}async findAll(e){try{let t,r;const o=l.DealerModel.query(),i=l.DealerModel.query();e?.filters&&(this.logger.log("apply filters data"),(0,d.applyFilters)(e.filters,o),(0,d.applyFilters)(e.filters,i)),e?.sorts&&(this.logger.log("apply sort data"),(0,d.applySorts)(e.sorts,o)),e instanceof c.PaginationDto&&(t=e.page,r=e.count,this.logger.log("apply pagination data"),(0,d.applyPagination)({page:t,count:r},o));const[n,s]=await Promise.all([o,i.count("* as count")]);return{page:t,count:r,total:parseInt(s[0]?.count),items:n}}catch(e){throw this.logger.error(`Error finding all dealers: ${e.message}`),e}}async findById(e){try{const t=await l.DealerModel.query().findById(e);if(!t)throw new a.NotFoundException(`Dealer with id ${e} not found`);return t}catch(e){throw this.logger.error(`Error finding dealer by id: ${e.message}`),e}}async update(e,t){try{const r=await this.findById(e),o=await r.$query().updateAndFetch(t);return this.logger.log(`Dealer ${e} updated`),o}catch(e){throw this.logger.error(`Error updating dealer: ${e.message}`),e}}async delete(e){try{const t=await this.findById(e);await t.$query().delete(),this.logger.log(`Dealer ${e} deleted`)}catch(e){throw this.logger.error(`Error deleting dealer: ${e.message}`),e}}};t.DealerService=u,t.DealerService=u=i([(0,a.Injectable)(),s(0,(0,a.Inject)(a.Logger)),s(0,(0,a.Optional)()),n("design:paramtypes",["function"==typeof(o=void 0!==a.LoggerService&&a.LoggerService)?o:Object])],u)},2585:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0})},2618:function(e,t,r){var o=this&&this.__decorate||function(e,t,r,o){var i,n=arguments.length,s=n<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(s=(n<3?i(s):n>3?i(t,r,s):i(t,r))||s);return n>3&&s&&Object.defineProperty(t,r,s),s};Object.defineProperty(t,"__esModule",{value:!0}),t.DealerModule=void 0;const i=r(1813),n=r(2563);let s=class{};t.DealerModule=s,t.DealerModule=s=o([(0,i.Module)({providers:[n.DealerService],exports:[n.DealerService]})],s)},2717:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0})},2848:function(e,t,r){var o=this&&this.__createBinding||(Object.create?function(e,t,r,o){void 0===o&&(o=r);var i=Object.getOwnPropertyDescriptor(t,r);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,o,i)}:function(e,t,r,o){void 0===o&&(o=r),e[o]=t[r]}),i=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||o(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),i(r(823),t),i(r(7118),t)},2982:function(e,t,r){var o=this&&this.__decorate||function(e,t,r,o){var i,n=arguments.length,s=n<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(s=(n<3?i(s):n>3?i(t,r,s):i(t,r))||s);return n>3&&s&&Object.defineProperty(t,r,s),s};Object.defineProperty(t,"__esModule",{value:!0}),t.DatabaseModule=void 0;const i=r(1813),n=r(7435);let s=class{};t.DatabaseModule=s,t.DatabaseModule=s=o([(0,i.Global)(),(0,i.Module)({providers:n.databaseProviders,exports:n.databaseProviders})],s)},3020:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.paginationExtractOffsetAndLimit=function(e){const t=!e?.page||e.page<=0||"number"!=typeof e.page||isNaN(e.page)?1:e.page,r=!e?.count||e.count<=0||"number"!=typeof e.count||isNaN(e.count)?10:e.count;return{offset:(t-1)*r,limit:r}},t.paginationSanitizeFilterValue=function e(t,r){switch(typeof t){case"undefined":case"boolean":case"string":case"number":return t;case"object":if(null===t)return null;if(!(t instanceof Array))return t instanceof Date?t:JSON.stringify(t);switch(r){case"in":case"notIn":return t.map(t=>e(t,r));case"equal":case"notEqual":case"like":case"lessThan":case"greaterThan":case"isNull":case"isNotNull":return String(t);default:return t.slice(0,2).map(e)}case"symbol":case"function":case"bigint":return String(t)}},t.paginationSanitizeSortValue=function(e){if("string"==typeof e)return e.toUpperCase();return"ASC"},t.paginationSanitizeRegex=function(e){return"string"!=typeof e?"":e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")},t.simplePaginatedList=async function(e,t){const{filters:r,page:i,count:n,sorts:s}=t;r&&(0,o.applyFilters)(r,e);const a=await e.resultSize();s?(0,o.applySorts)(s,e):(0,o.applySorts)([{id:"DESC"}],e);return(0,o.applyPagination)({page:i,count:n},e),{page:i,count:n,items:await e.execute(),total:a}};const o=r(4413)},3037:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0})},3120:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0})},3147:function(e,t,r){var o=this&&this.__decorate||function(e,t,r,o){var i,n=arguments.length,s=n<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(s=(n<3?i(s):n>3?i(t,r,s):i(t,r))||s);return n>3&&s&&Object.defineProperty(t,r,s),s};Object.defineProperty(t,"__esModule",{value:!0}),t.UserService=void 0;const i=r(1813),n=r(1944);let s=class{constructor(){this.logger=new i.Logger("UserService")}async listAllUsers(){try{return await n.UserModel.query().select("*")}catch(e){throw new i.BadRequestException("Failed to fetch users")}}async findUserById(e){try{const t=await n.UserModel.query().findById(e);if(!t)throw new i.NotFoundException(`User with ID ${e} not found`);return t}catch(e){if(e instanceof i.NotFoundException)throw e;throw new i.BadRequestException("Failed to fetch user")}}async createUser(e){try{if(!e.firstName||!e.lastName||!e.accountName)throw new i.BadRequestException("First name, last name, and account name are required");return await n.UserModel.query().insert({...e})}catch(e){if(e instanceof i.BadRequestException)throw e;throw new i.BadRequestException("Failed to create user")}}async updateUser(e,t){try{if(!await this.findUserById(e))throw new i.NotFoundException(`User with ID ${e} not found`);await n.UserModel.query().findById(e).patch({...t});return await n.UserModel.query().findById(e)}catch(e){if(e instanceof i.NotFoundException||e instanceof i.BadRequestException)throw e;throw new i.BadRequestException("Failed to update user")}}async deleteUser(e){try{if(!await this.findUserById(e))throw new i.NotFoundException(`User with ID ${e} not found`);return await n.UserModel.query().findById(e).del(),{message:`User with ID ${e} deleted successfully`,id:e}}catch(e){if(e instanceof i.NotFoundException||e instanceof i.BadRequestException)throw e;throw new i.BadRequestException("Failed to delete user")}}async searchByEmail(e){try{if(!e)throw new i.BadRequestException("Email is required");return await n.UserModel.query().where("email","ilike",`%${e}%`)}catch(e){if(e instanceof i.BadRequestException)throw e;throw new i.BadRequestException("Failed to search users")}}async searchByName(e,t){try{if(!e)throw new i.BadRequestException("First name is required");let r=n.UserModel.query().where("firstName","ilike",`%${e}%`);t&&(r=r.orWhere("lastName","ilike",`%${t}%`));return await r}catch(e){if(e instanceof i.BadRequestException)throw e;throw new i.BadRequestException("Failed to search users")}}async getUsersWithPagination(e=1,t=10){try{if(e<1||t<1)throw new i.BadRequestException("Page and limit must be greater than 0");const r=(e-1)*t,o=n.UserModel.query(),s=await o.resultSize();return{data:await o.offset(r).limit(t),total:s,page:e,limit:t}}catch(e){if(e instanceof i.BadRequestException)throw e;throw new i.BadRequestException("Failed to fetch users")}}async getUsersByRoleId(e){try{if(!e)throw new i.BadRequestException("Role ID is required");return await n.UserModel.query().where("roleId",e)}catch(e){if(e instanceof i.BadRequestException)throw e;throw new i.BadRequestException("Failed to fetch users by role")}}async createUserFromCustomers(e){this.logger.log(`Create new user from customer ids: ${e.map(e=>e.id)}`);const t={email:"email",accountName:"accountName",firstName:"firstName",middleName:"middleName",lastName:"lastName",mobilePhone:"mobilePhone"},r={};if(e.forEach(e=>{Object.entries(t).filter(([e,t])=>!r[t]).map(([t,o])=>{e[t]&&(r[o]=e[t])})}),r.roleId=(await n.RoleModel.query().select("id").where("slug","customer").first())?.id,r.loginAttempts=0,r.otpCodeAttempt=0,!r.roleId)return this.logger.error('Fail create user from customer, no "customer" defined'),Promise.reject(new i.InternalServerErrorException("No customer role defined"));if(!r.email&&!r.mobilePhone)return this.logger.warn(`Fail create user, merged data: ${JSON.stringify(r)}`),Promise.reject(new i.BadRequestException("Create user from customer requires email or phone number"));const o=await n.UserModel.query().insert(r).returning("*").withGraphFetched("role").first();return await n.CustomerModel.query().where(e=>{r.email&&e.where("email",r.email),r.mobilePhone&&e.orWhere("mobilePhone",r.mobilePhone)}).update({userId:o.id}),o}};t.UserService=s,t.UserService=s=o([(0,i.Injectable)()],s)},3171:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0});const o=r(7861);class i extends o.Model{}i.tableName="Technicians",i.idColumn="id",i.jsonSchema={type:"object",properties:{id:{type:"integer"},userId:{type:"integer"},nsc:{type:"string"},startDate:{type:["string","null"]},endDate:{type:["string","null"]},password:{type:"string"},forgotPassword:{type:"string"},activationCode:{type:"string"},loginAttempts:{type:"integer"},lockUntil:{type:["string","null"]},lastLogin:{type:["string","null"]},lastNotifUpdatePassword:{type:["string","null"]},lastUpdatePassword:{type:["string","null"]}}},t.default=i},3219:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ValidationException=t.ApiException=void 0;const o=r(1813),i=r(9856);class n extends o.HttpException{constructor(e=o.HttpStatus.INTERNAL_SERVER_ERROR,t,r,n){const s={statusCode:e,message:i.STATUS_CODES[e]||"Unknown Error",cause:r,description:n,source:process.env.APP_NAME||"unknown"};t&&(s.errorDetails=Array.isArray(t)?t:[t]),super(o.HttpException.createBody(s),e)}getResponse(){return super.getResponse()}}t.ApiException=n;class s extends n{constructor(e,t=o.HttpStatus.BAD_REQUEST){const r=Object.create(null);super(t,s.flattenValidationErrors(e,r)),this.errorFields={},this.errorFields=r}static error(e,t,r="invalid"){const o={};return o.property=e,o.constraints={[r]:t},new s([o])}static flattenValidationErrors(e,t){return e.map(e=>this.mapChildrenToValidationErrors(e)).flat().filter(e=>!!e.constraints).map(e=>{const r=Object.values(e.constraints);return t[e.property]=r,r}).flat()}static mapChildrenToValidationErrors(e,t){if(!e.children||!e.children.length)return[e];const r=[];t=t?`${t}.${e.property}`:e.property;for(const o of e.children)o.children&&o.children.length&&r.push(...this.mapChildrenToValidationErrors(o,t)),r.push(this.prependConstraintsWithParentProp(t,o));return r}static prependConstraintsWithParentProp(e,t){const r={};for(const o in t.constraints)r[o]=`${e}.${t.constraints[o]}`;return{...t,constraints:r}}}t.ValidationException=s},3487:function(e,t,r){var o=this&&this.__createBinding||(Object.create?function(e,t,r,o){void 0===o&&(o=r);var i=Object.getOwnPropertyDescriptor(t,r);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,o,i)}:function(e,t,r,o){void 0===o&&(o=r),e[o]=t[r]}),i=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||o(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),i(r(7326),t),i(r(944),t),i(r(4338),t),i(r(467),t)},3523:function(e,t,r){var o=this&&this.__decorate||function(e,t,r,o){var i,n=arguments.length,s=n<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(s=(n<3?i(s):n>3?i(t,r,s):i(t,r))||s);return n>3&&s&&Object.defineProperty(t,r,s),s},i=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(t,"__esModule",{value:!0}),t.UpdateInvoiceDto=t.CreateInvoiceDto=void 0;const n=r(6325),s=r(2520);class a{}t.CreateInvoiceDto=a,o([(0,s.ApiProperty)({description:"Work Order ID associated with the invoice",example:101}),(0,n.IsNotEmpty)(),(0,n.IsNumber)(),i("design:type",Number)],a.prototype,"workOrderId",void 0),o([(0,s.ApiProperty)({description:"Invoice Number",example:"INV-2023-001"}),(0,n.IsNotEmpty)(),(0,n.IsString)(),i("design:type",String)],a.prototype,"invoiceNumber",void 0),o([(0,s.ApiProperty)({description:"Total amount of the invoice",example:1500}),(0,n.IsNotEmpty)(),(0,n.IsNumber)(),(0,n.Min)(0),i("design:type",Number)],a.prototype,"totalAmount",void 0),o([(0,s.ApiPropertyOptional)({description:"Issue Date",example:"2023-10-27"}),(0,n.IsOptional)(),(0,n.IsString)(),i("design:type",String)],a.prototype,"issueDate",void 0),o([(0,s.ApiPropertyOptional)({description:"Due Date",example:"2023-11-27"}),(0,n.IsOptional)(),(0,n.IsString)(),i("design:type",String)],a.prototype,"dueDate",void 0),o([(0,s.ApiProperty)({description:"Status of the invoice",example:"Issued"}),(0,n.IsNotEmpty)(),(0,n.IsString)(),i("design:type",String)],a.prototype,"status",void 0);class l{}t.UpdateInvoiceDto=l,o([(0,s.ApiPropertyOptional)({description:"Total amount of the invoice",example:1600}),(0,n.IsOptional)(),(0,n.IsNumber)(),(0,n.Min)(0),i("design:type",Number)],l.prototype,"totalAmount",void 0),o([(0,s.ApiPropertyOptional)({description:"Issue Date",example:"2023-10-27"}),(0,n.IsOptional)(),(0,n.IsString)(),i("design:type",String)],l.prototype,"issueDate",void 0),o([(0,s.ApiPropertyOptional)({description:"Due Date",example:"2023-11-27"}),(0,n.IsOptional)(),(0,n.IsString)(),i("design:type",String)],l.prototype,"dueDate",void 0),o([(0,s.ApiPropertyOptional)({description:"Status of the invoice",example:"Paid"}),(0,n.IsOptional)(),(0,n.IsString)(),i("design:type",String)],l.prototype,"status",void 0)},3691:function(e,t,r){var o=this&&this.__createBinding||(Object.create?function(e,t,r,o){void 0===o&&(o=r);var i=Object.getOwnPropertyDescriptor(t,r);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,o,i)}:function(e,t,r,o){void 0===o&&(o=r),e[o]=t[r]}),i=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||o(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),i(r(4878),t),i(r(9347),t),i(r(8446),t),i(r(2459),t)},3716:(e,t)=>{var r;Object.defineProperty(t,"__esModule",{value:!0}),t.WorkOrderPriorityEnum=void 0,function(e){e.None="None",e.Low="Low",e.Medium="Medium",e.High="High"}(r||(t.WorkOrderPriorityEnum=r={}))},3847:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ModelService=t.ModelModule=void 0;var o=r(2526);Object.defineProperty(t,"ModelModule",{enumerable:!0,get:function(){return o.ModelModule}});var i=r(5063);Object.defineProperty(t,"ModelService",{enumerable:!0,get:function(){return i.ModelService}})},3856:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0})},4014:function(e,t,r){var o=this&&this.__createBinding||(Object.create?function(e,t,r,o){void 0===o&&(o=r);var i=Object.getOwnPropertyDescriptor(t,r);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,o,i)}:function(e,t,r,o){void 0===o&&(o=r),e[o]=t[r]}),i=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||o(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),t.PaginationValidator=t.PaginationTransformer=t.PaginationAdapter=void 0,t.PaginationAdapter=r(2202),t.PaginationTransformer=r(581),t.PaginationValidator=r(1916),i(r(5084),t),i(r(7621),t),i(r(3020),t)},4218:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0});const o=r(7861),i=r(7729);class n extends o.Model{}n.tableName=i.constants.TableName.WorkOrderSubStatus,n.idColumn="id",n.jsonSchema={type:"object",properties:{id:{type:"integer"},workOrderStatusId:{type:"integer"},slug:{type:"string"},name:{type:"string"},createdAt:{type:"string"},createdBy:{type:"integer"}}},t.default=n},4222:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.CoreInterceptor=void 0;const o=r(9856),i=r(573),n=r(8491);t.CoreInterceptor=class{constructor(){this.source=process.env.APP_NAME||"unknown",!process.env.APP_NAME&&process.env.PACKAGE_NAME&&(this.source=process.env.PACKAGE_NAME,this.source.includes("/")&&(this.source=this.source.replace(/^[^/]+\//,""))),process.env.PACKAGE_VERSION&&(this.source+=`@${process.env.PACKAGE_VERSION}`)}intercept(e,t){return t.handle().pipe((0,i.map)(t=>{const r=e.switchToHttp().getRequest().res,i=r?.statusCode||200,s={statusCode:i,message:o.STATUS_CODES[i]||"Unknown Status",source:this.source};return t instanceof n.InterceptorResponse?(Object.assign(s,t.getResponse()),s.statusCode!=i&&(r.statusCode=s.statusCode)):s.result=t,s}))}}},4246:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0})},4332:function(e,t,r){var o=this&&this.__decorate||function(e,t,r,o){var i,n=arguments.length,s=n<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(s=(n<3?i(s):n>3?i(t,r,s):i(t,r))||s);return n>3&&s&&Object.defineProperty(t,r,s),s};Object.defineProperty(t,"__esModule",{value:!0}),t.WarrantyModule=void 0;const i=r(1813),n=r(5501);let s=class{};t.WarrantyModule=s,t.WarrantyModule=s=o([(0,i.Module)({providers:[n.WarrantyService],exports:[n.WarrantyService]})],s)},4338:function(e,t,r){var o,i,n,s,a,l=this&&this.__decorate||function(e,t,r,o){var i,n=arguments.length,s=n<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(s=(n<3?i(s):n>3?i(t,r,s):i(t,r))||s);return n>3&&s&&Object.defineProperty(t,r,s),s},c=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(t,"__esModule",{value:!0}),t.UpdatePartnerDto=t.CreatePartnerDto=t.UpdatePartnerAccountInformationDto=t.PartnerAccountInformationDto=t.PartnerAddressDto=void 0;const d=r(6325),u=r(284),p=r(6088),f=r(5007),g=r(5635);class y{}t.PartnerAddressDto=y,l([(0,d.IsString)({message:"Country must be a string"}),(0,d.IsOptional)(),(0,u.Transform)(({value:e})=>(0,g.safeTrim)(e)),c("design:type",String)],y.prototype,"country",void 0),l([(0,d.IsString)({message:"Province must be a string"}),(0,d.IsOptional)(),(0,u.Transform)(({value:e})=>(0,g.safeTrim)(e)),c("design:type",String)],y.prototype,"province",void 0),l([(0,d.IsString)({message:"City must be a string"}),(0,d.IsOptional)(),(0,u.Transform)(({value:e})=>(0,g.safeTrim)(e)),c("design:type",String)],y.prototype,"city",void 0),l([(0,d.IsString)({message:"Sub-district must be a string"}),(0,d.IsOptional)(),(0,u.Transform)(({value:e})=>(0,g.safeTrim)(e)),c("design:type",String)],y.prototype,"subDistrict",void 0),l([(0,d.IsString)({message:"Village must be a string"}),(0,d.IsOptional)(),(0,u.Transform)(({value:e})=>(0,g.safeTrim)(e)),c("design:type",String)],y.prototype,"village",void 0),l([(0,d.IsInt)({message:"Postal code must be a string"}),(0,d.IsOptional)(),c("design:type",Number)],y.prototype,"postalCode",void 0),l([(0,d.IsString)({message:"Street must be a string"}),(0,d.IsOptional)(),(0,u.Transform)(({value:e})=>(0,g.safeTrim)(e)),c("design:type",String)],y.prototype,"street",void 0);class m{}t.PartnerAccountInformationDto=m,l([(0,d.IsString)({message:"name must be a string"}),(0,d.IsNotEmpty)({message:"name should not be empty"}),(0,u.Transform)(({value:e})=>(0,g.safeTrim)(e)),c("design:type",String)],m.prototype,"name",void 0),l([(0,d.IsEnum)(p.SalutationEnum,{message:"salutation must be a valid enum value"}),c("design:type","function"==typeof(o=void 0!==p.SalutationEnum&&p.SalutationEnum)?o:Object)],m.prototype,"salutation",void 0),l([(0,d.IsEmail)({},{message:"email must be a valid email address"}),(0,u.Transform)(({value:e})=>(0,g.safeTrim)(e)),c("design:type",String)],m.prototype,"email",void 0),l([(0,d.IsAlphanumeric)(),(0,d.Length)(8,15,{message:"businessPhone must be between 8 and 15 characters long"}),(0,d.IsOptional)(),c("design:type",String)],m.prototype,"businessPhone",void 0),l([(0,d.IsAlphanumeric)(),(0,d.Length)(8,15,{message:"mobilePhone must be between 8 and 15 characters long"}),(0,d.IsNotEmpty)({message:"mobilePhone should not be empty"}),c("design:type",String)],m.prototype,"mobilePhone",void 0),l([(0,d.IsString)({message:"suffix must be a string"}),(0,d.IsOptional)(),(0,u.Transform)(({value:e})=>(0,g.safeTrim)(e)),c("design:type",String)],m.prototype,"suffix",void 0),l([(0,d.IsEnum)(p.GenderEnum,{message:"gender must be a valid enum value"}),c("design:type","function"==typeof(i=void 0!==p.GenderEnum&&p.GenderEnum)?i:Object)],m.prototype,"gender",void 0),l([(0,d.IsBoolean)({message:"status must be a boolean"}),c("design:type",Boolean)],m.prototype,"status",void 0),l([(0,d.IsString)({message:"password must be a string"}),(0,d.IsNotEmpty)({message:"password should not be empty"}),(0,d.Matches)(/^(?=.*[A-Z])(?=.*[0-9]).{8,}$/,{message:"password must be at least 8 characters long and contain at least one uppercase letter and one number"}),(0,u.Transform)(({value:e})=>e?.trim()),c("design:type",String)],m.prototype,"password",void 0),l([(0,d.IsString)({message:"taxPayerId must be a string"}),(0,d.IsOptional)(),(0,u.Transform)(({value:e})=>(0,g.safeTrim)(e)),c("design:type",String)],m.prototype,"taxPayerId",void 0),l([(0,d.IsString)({message:"remark must be a string"}),(0,d.IsOptional)(),(0,u.Transform)(({value:e})=>(0,g.safeTrim)(e)),c("design:type",String)],m.prototype,"remark",void 0),l([(0,d.IsNumber)({},{message:"roleId must be a number"}),(0,d.IsNotEmpty)({message:"roleId should not be empty"}),c("design:type",Number)],m.prototype,"roleId",void 0),l([(0,d.IsNumber)({},{message:"integrationId must be a number"}),(0,d.IsOptional)(),c("design:type",Number)],m.prototype,"integrationId",void 0),l([(0,d.IsNumber)({},{message:"territoryId must be a number"}),(0,d.IsNotEmpty)({message:"territoryId should not be empty"}),c("design:type",Number)],m.prototype,"territoryId",void 0),l([(0,d.IsNumber)({},{message:"nscBranchId must be a number"}),(0,d.IsOptional)(),c("design:type",Number)],m.prototype,"nscBranchId",void 0),l([(0,d.IsDate)({message:"startDate must be a valid date"}),(0,d.IsOptional)(),(0,u.Type)(()=>Date),c("design:type","function"==typeof(n="undefined"!=typeof Date&&Date)?n:Object)],m.prototype,"startDate",void 0),l([(0,d.IsDate)({message:"endDate must be a valid date"}),(0,d.IsOptional)(),(0,u.Type)(()=>Date),c("design:type","function"==typeof(s="undefined"!=typeof Date&&Date)?s:Object)],m.prototype,"endDate",void 0),l([(0,d.IsString)({message:"technicalSkill must be a string"}),(0,d.IsOptional)(),(0,u.Transform)(({value:e})=>(0,g.safeTrim)(e)),c("design:type",String)],m.prototype,"technicalSkill",void 0);class h extends((0,f.PartialType)((0,f.OmitType)(m,["password"]))){}t.UpdatePartnerAccountInformationDto=h;class b{}t.CreatePartnerDto=b,l([(0,d.ValidateNested)(),(0,u.Type)(()=>m),(0,d.IsNotEmpty)({message:"Account information should not be empty"}),c("design:type",m)],b.prototype,"accountInformation",void 0),l([(0,d.ValidateNested)(),(0,u.Type)(()=>y),(0,d.IsOptional)(),c("design:type",y)],b.prototype,"billingAddressInformation",void 0),l([(0,d.ValidateNested)(),(0,u.Type)(()=>y),(0,d.IsOptional)(),c("design:type",y)],b.prototype,"mailingAddressInformation",void 0);class v{}t.UpdatePartnerDto=v,l([(0,d.ValidateNested)(),(0,u.Type)(()=>h),(0,d.IsOptional)(),c("design:type","function"==typeof(a="undefined"!=typeof Partial&&Partial)?a:Object)],v.prototype,"accountInformation",void 0),l([(0,d.ValidateNested)(),(0,u.Type)(()=>y),(0,d.IsOptional)(),c("design:type",y)],v.prototype,"billingAddressInformation",void 0),l([(0,d.ValidateNested)(),(0,u.Type)(()=>y),(0,d.IsOptional)(),c("design:type",y)],v.prototype,"mailingAddressInformation",void 0)},4339:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0})},4383:e=>{e.exports=require("fs")},4413:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.isKnexBuilder=function(e){return"QueryBuilder"!=e.constructor?.name},t.applyOperatorValue=s,t.applySorts=function(e,t){if(void 0===t)throw new Error("Invalid builder object");for(const r of e)for(const[e,o]of Object.entries(r))t.orderBy(e,o);return t},t.applyFilters=function e(t,r){if(void 0===r)throw new Error("Invalid builder object");if(Array.isArray(t))t.forEach(t=>{r.orWhere(r=>{e(t,r)})});else if(t instanceof Map)t.forEach((e,t)=>{s(r,e,t)});else{if(!(0,o.isPlainObject)(t))throw new Error(`Unhandled filter type: ${"object"==typeof t&&null!==t?t.constructor.name:typeof t}`);Object.entries(t).forEach(([t,o])=>{"_searchGroup"===t&&Array.isArray(o)?r.where(t=>{o.forEach(r=>{t.orWhere(t=>{e(r,t)})})}):s(r,o,t)})}return r},t.applyPagination=function(e,t){const{offset:r,limit:o}=(0,n.paginationExtractOffsetAndLimit)(e);return t.offset(r).limit(o)};const o=r(7546),i=r(5448),n=r(3020);function s(e,t,r){let o;switch("object"!=typeof t&&(t={op:"equal",value:t}),o="in"===t.op||"notIn"===t.op?(0,n.paginationSanitizeFilterValue)(t.value,t.op):(0,n.paginationSanitizeFilterValue)(t.value),t.op){case"equal":case"notEqual":case"lessThan":case"greaterThan":return e.where(r,i.operatorMapSQL[t.op],o);case"between":return e.where(r,t.op,o);case"like":return e.where(r,"ilike",`%${o}%`);case"isNull":return e.whereNull(r);case"isNotNull":return e.whereNotNull(r);case"in":return e.whereIn(r,o);case"notIn":return e.whereNotIn(r,o);default:throw new Error(`Invalid filter operator: ${String(t.op)}`)}}},4424:function(e,t,r){var o=this&&this.__decorate||function(e,t,r,o){var i,n=arguments.length,s=n<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(s=(n<3?i(s):n>3?i(t,r,s):i(t,r))||s);return n>3&&s&&Object.defineProperty(t,r,s),s};Object.defineProperty(t,"__esModule",{value:!0}),t.TechnicianModule=void 0;const i=r(1813),n=r(6329);let s=class{};t.TechnicianModule=s,t.TechnicianModule=s=o([(0,i.Module)({providers:[n.TechnicianService],exports:[n.TechnicianService]})],s)},4457:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ProductService=t.ProductModule=void 0;var o=r(9498);Object.defineProperty(t,"ProductModule",{enumerable:!0,get:function(){return o.ProductModule}});var i=r(5075);Object.defineProperty(t,"ProductService",{enumerable:!0,get:function(){return i.ProductService}})},4500:function(e,t,r){var o=this&&this.__createBinding||(Object.create?function(e,t,r,o){void 0===o&&(o=r);var i=Object.getOwnPropertyDescriptor(t,r);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,o,i)}:function(e,t,r,o){void 0===o&&(o=r),e[o]=t[r]}),i=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||o(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),i(r(9835),t)},4588:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0});const o=r(7861),i=r(8239);class n extends o.Model{}n.tableName=i.TableName.Dealers,t.default=n},4602:e=>{e.exports=require("@nestjs/passport")},4626:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0})},4671:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.checkAccess=function(e,t){if(e&&!t)return!1;if(!e)return!0;for(const r in Object.keys(e)){const o=e[r],i=t[r];if(!i||!Array.isArray(i))return!1;for(const e of o)if(!i.includes(e))return!1}return!0},t.getMissingAccess=function(e,t){if(e&&!t)return e;const r={};if(!e)return r;for(const o of Object.keys(e)){const i=e[o],n=t[o];if(n&&Array.isArray(n))for(const e of i)n.includes(e)||(o in r||(r[o]=[]),r[o].push(e));else r[o]=i}return r},t.stringifyAccess=function(e){const t=[];for(const r in e)t.push(e[r].join(", ")+" on module "+r);return t.join(" AND ")}},4724:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0})},4745:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0});const o=r(7861);class i extends o.Model{}i.tableName="Modules",i.idColumn="id",i.jsonSchema={type:"object",properties:{id:{type:"integer"},slug:{type:"string"},moduleName:{type:"string"},description:{type:"string"},order:{type:"integer"},permissions:{type:"array"},permissionsHash:{type:"string"},menus:{type:"array"},menusHash:{type:"string"},isActive:{type:"boolean"}}},t.default=i},4754:e=>{e.exports=require("ms")},4773:function(e,t,r){var o=this&&this.__decorate||function(e,t,r,o){var i,n=arguments.length,s=n<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(s=(n<3?i(s):n>3?i(t,r,s):i(t,r))||s);return n>3&&s&&Object.defineProperty(t,r,s),s};Object.defineProperty(t,"__esModule",{value:!0}),t.ChargeService=void 0;const i=r(1813),n=r(9709),s=r(4014);let a=class{async listCharges(e,t,r){const o=n.default.query();return r&&o.where("workOrderId",r),t&&o.where("name","like",`%${t}%`),e?(0,s.simplePaginatedList)(o,e):o}async getChargesByWorkOrder(e){return n.default.query().where("workOrderId",e)}async getChargeById(e){const t=await n.default.query().findById(e);if(!t)throw new i.NotFoundException(`Charge with ID ${e} not found`);return t}async createCharge(e){return n.default.query().insert(e)}async updateCharge(e,t){return(await this.getChargeById(e)).$query().patchAndFetch(t)}async deleteCharge(e){if(0===await n.default.query().deleteById(e))throw new i.NotFoundException(`Charge with ID ${e} not found`);return{success:!0,id:e}}};t.ChargeService=a,t.ChargeService=a=o([(0,i.Injectable)()],a)},4808:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0});const o=r(7861),i=r(1350),n=r(8239);class s extends o.Model{static get relationMappings(){return{model:{relation:o.Model.BelongsToOneRelation,modelClass:i.default,join:{from:`${n.TableName.Products}.modelId`,to:`${n.TableName.Models}.id`}}}}}s.tableName=n.TableName.Products,t.default=s},4865:function(e,t,r){var o=this&&this.__decorate||function(e,t,r,o){var i,n=arguments.length,s=n<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(s=(n<3?i(s):n>3?i(t,r,s):i(t,r))||s);return n>3&&s&&Object.defineProperty(t,r,s),s};Object.defineProperty(t,"__esModule",{value:!0}),t.CreateWorkOrderUseCase=void 0;const i=r(1813),n=r(6245);let s=class{constructor(){this.logger=new i.Logger("CreateWorkOrderUseCase")}async execute(e){return this.params=e,this.data=this.params.data,await this.setData(),await this.insertData(),this.result}async setData(){this.data.createdBy=this.params.token.userId,this.logger.log(`CreateWorkOrderUseCase: setData executed with data: ${JSON.stringify(this.data)}`)}async insertData(){const e=await n.WorkOrderModel.query().insert({...this.data});this.result=e}};t.CreateWorkOrderUseCase=s,t.CreateWorkOrderUseCase=s=o([(0,i.Injectable)()],s)},4873:function(e,t,r){var o=this&&this.__decorate||function(e,t,r,o){var i,n=arguments.length,s=n<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(s=(n<3?i(s):n>3?i(t,r,s):i(t,r))||s);return n>3&&s&&Object.defineProperty(t,r,s),s};Object.defineProperty(t,"__esModule",{value:!0}),t.WorkOrderService=void 0;const i=r(1813),n=r(4865),s=r(1187),a=r(6172),l=r(2178);let c=class{async create(e,t){const r=new n.CreateWorkOrderUseCase;return await r.execute({data:e,token:t})}async findAll(){const e=new s.GetAllWorkOrderUseCase;return await e.execute()}async update(e,t,r){const o=new l.UpdateWorkOrderUseCase;return await o.execute({id:e,data:t,token:r})}async softDelete(e,t){const r=new a.DeleteWorkOrderUseCase;return await r.execute({id:e,token:t})}};t.WorkOrderService=c,t.WorkOrderService=c=o([(0,i.Injectable)()],c)},4878:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0})},4991:e=>{e.exports=require("@aws-sdk/s3-request-presigner")},5e3:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0});const o=r(7861);class i extends o.Model{}i.tableName="Invoices",i.idColumn="id",i.jsonSchema={type:"object",required:["invoiceNumber","workOrderId","totalAmount","status"],properties:{id:{type:"integer"},invoiceNumber:{type:"string"},workOrderId:{type:"integer"},totalAmount:{type:"number"},issueDate:{type:["string","null"]},dueDate:{type:["string","null"]},status:{type:"string"},createdAt:{type:"string"},updatedAt:{type:"string"},createdBy:{type:"integer"},updatedBy:{type:"integer"}}},t.default=i},5007:e=>{e.exports=require("@nestjs/mapped-types")},5033:function(e,t,r){var o,i,n=this&&this.__decorate||function(e,t,r,o){var i,n=arguments.length,s=n<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(s=(n<3?i(s):n>3?i(t,r,s):i(t,r))||s);return n>3&&s&&Object.defineProperty(t,r,s),s},s=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},a=this&&this.__param||function(e,t){return function(r,o){t(r,o,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.CustomerService=void 0;const l=r(1813),c=r(1944),d=r(7976),u=r(1706),p=r(9474),f=r(6088),g=r(9044),y=r(4014),m=r(4413),h=r(5364);let b=class{constructor(e,t){this.logger=e,this.s3Service=t,this.CUSTOMER_SEARCH_COLUMNS=["idText","name","email","mobilePhone","createdByName","updatedByName"],e||(this.logger=new l.Logger("CustomerService"))}transformFlattenedDtoToNested(e){return{accountInformation:{name:e.name,salutation:e.salutation,email:e.email,businessPhone:e.businessPhone,mobilePhone:e.mobilePhone,suffix:e.suffix,gender:e.gender,status:e.status,membershipType:e.membershipType,remark:e.remark},billingAddressInformation:{country:e.billingCountry,province:e.billingProvince,city:e.billingCity,subDistrict:e.billingSubDistrict,village:e.billingVillage,postalCode:e.billingPostalCode,street:e.billingStreet},mailingAddressInformation:{country:e.mailingCountry,province:e.mailingProvince,city:e.mailingCity,subDistrict:e.mailingSubDistrict,village:e.mailingVillage,postalCode:e.mailingPostalCode,street:e.mailingStreet}}}async checkEmailExists(e,t){let r=c.CustomerModel.query().where("email",e).where("deleteFlag",!1);t&&(r=r.whereNot("id",t));return!!await r.first()}async checkMobilePhoneExists(e,t){let r=c.CustomerModel.query().where("mobilePhone",e).where("deleteFlag",!1);t&&(r=r.whereNot("id",t));return!!await r.first()}async checkBusinessPhoneExists(e,t){let r=c.UserModel.query().where("businessPhone",e);t&&(r=r.whereNot("id",t));return!!await r.first()}async validateUniqueFieldsForCreate(e){const t={};if(e.email){await this.checkEmailExists(e.email)&&(t.email="email is exist")}if(e.mobilePhone){await this.checkMobilePhoneExists(e.mobilePhone)&&(t.mobilePhone="mobile phone is exist")}if(e.businessPhone){await this.checkBusinessPhoneExists(e.businessPhone)&&(t.businessPhone="business phone is exist")}if(Object.keys(t).length>0){const e=[];throw Object.entries(t).forEach(([t,r])=>{e.push({property:t,constraints:{unique:r}})}),new g.ValidationException(e)}}async validateUniqueFieldsForUpdate(e,t){const r=await c.CustomerModel.query().findById(e);if(!r)throw new l.NotFoundException(`Customer with ID ${e} not found`);const o={};if(t.email){await this.checkEmailExists(t.email,e)&&(o.email="email is exist")}if(t.mobilePhone){await this.checkMobilePhoneExists(t.mobilePhone,e)&&(o.mobilePhone="mobile phone is exist")}if(t.businessPhone){await this.checkBusinessPhoneExists(t.businessPhone,r.userId)&&(o.businessPhone="business phoneis exist")}if(Object.keys(o).length>0){const e=[];throw Object.entries(o).forEach(([t,r])=>{e.push({property:t,constraints:{unique:r}})}),new g.ValidationException(e)}}buildCustomersSubquery(){return c.CustomerModel.query().join("Users","Customers.userId","=","Users.id").leftJoin("Users as CreatedByUser","Customers.createdBy","=","CreatedByUser.id").leftJoin("Users as UpdatedByUser","Customers.updatedBy","=","UpdatedByUser.id").where("Customers.deleteFlag",!1).select("Customers.id","Customers.email","Customers.firstName","Customers.middleName","Customers.lastName","Customers.mobilePhone","Customers.membershipType","Customers.createdAt","Customers.updatedAt","Users.status",c.CustomerModel.raw('CAST("Customers"."id" AS TEXT) as "idText"'),c.CustomerModel.raw('CONCAT("Customers"."firstName", \' \', COALESCE("Customers"."middleName", \'\'), \' \', "Customers"."lastName") as "name"'),c.CustomerModel.raw('CASE \n          WHEN COALESCE("CreatedByUser"."firstName", \'\') = \'\' \n            AND COALESCE("CreatedByUser"."middleName", \'\') = \'\' \n            AND COALESCE("CreatedByUser"."lastName", \'\') = \'\' \n          THEN \'\'\n          ELSE TRIM(CONCAT(COALESCE("CreatedByUser"."firstName", \'\'), \' \', COALESCE("CreatedByUser"."middleName", \'\'), \' \', COALESCE("CreatedByUser"."lastName", \'\')))\n        END as "createdByName"'),c.CustomerModel.raw('CASE \n          WHEN COALESCE("UpdatedByUser"."firstName", \'\') = \'\' \n            AND COALESCE("UpdatedByUser"."middleName", \'\') = \'\' \n            AND COALESCE("UpdatedByUser"."lastName", \'\') = \'\' \n          THEN \'\'\n          ELSE TRIM(CONCAT(COALESCE("UpdatedByUser"."firstName", \'\'), \' \', COALESCE("UpdatedByUser"."middleName", \'\'), \' \', COALESCE("UpdatedByUser"."lastName", \'\')))\n        END as "updatedByName"'))}async listAllCustomers(e,t){let r,o;this.logger.log("initialization query - building subquery");const i=c.CustomerModel.query().from(this.buildCustomersSubquery().as("subquery"));this.logger.log("count data from subquery");const n=c.CustomerModel.query().from(this.buildCustomersSubquery().as("subquery")).count("* as count");if(e?.filters){this.logger.log("apply filters data");const t=(0,u.processSearchFilterWithColumns)(e.filters,this.CUSTOMER_SEARCH_COLUMNS);(0,m.applyFilters)(t,i),(0,m.applyFilters)(t,n)}e?.sorts&&(this.logger.log("apply sort data"),(0,m.applySorts)(e.sorts,i)),e instanceof y.PaginationDto&&(r=e.page,o=e.count,this.logger.log("apply pagination data"),(0,m.applyPagination)({page:r,count:o},i));const[s,a]=await Promise.all([i,n]);return{page:r,count:o,total:parseInt(a[0]?.count),items:s}}async findCustomerById(e,t){const r=await c.CustomerModel.query().findOne({id:e,deleteFlag:!1});if(!r)throw new l.NotFoundException(`Customer with ID ${e} not found`);const o=await c.UserModel.query().findById(r.userId);if(!o)throw new l.NotFoundException(`User with ID ${r.userId} not found`);let i=null;if(r.profilePicture)try{i=await this.getProfilePicturePresignedUrl(e)}catch(t){this.logger.warn(`Failed to generate presigned URL for customer ${e}: ${t.message}`)}const n={name:`${o.firstName} ${o.middleName||""} ${o.lastName}`.trim(),salutation:o.salutation,email:o.email,businessPhone:o.businessPhone,mobilePhone:o.mobilePhone,suffix:o.suffix,gender:o.gender,status:o.status,memberType:r.membershipType,remark:o.remark,profilePicture:i},s=await c.UserAddressModel.query().where("userId",r.userId).where("addressType",f.AddressTypeEnum.Billing).orderBy("id","desc").first(),a=await c.UserAddressModel.query().where("userId",r.userId).where("addressType",f.AddressTypeEnum.Mailing).orderBy("id","desc").first();return{accountInformation:n,billingAddressInformation:s?{country:s.country,province:s.stateOrProvince,city:s.city,subDistrict:s.subDistrict,village:s.village,postalCode:s.zipOrPostalCode,street:s.street}:{},mailingAddressInformation:a?{country:a.country,province:a.stateOrProvince,city:a.city,subDistrict:a.subDistrict,village:a.village,postalCode:a.zipOrPostalCode,street:a.street}:{}}}async createCustomer(e,t){const r=this.transformFlattenedDtoToNested(e),{accountInformation:o,billingAddressInformation:i,mailingAddressInformation:n}=r;await this.validateUniqueFieldsForCreate(o);const{firstName:s,middleName:a,lastName:u}=(0,d.splitName)(o.name),p={updatedBy:t.userId,createdBy:t.userId,updatedAt:new Date};let g=null;if(e.profilePicture)try{const t=e.profilePicture;this.logger.debug(`File received for upload - originalname: ${t.originalname}, mimetype: ${t.mimetype}, size: ${t.size||t.buffer?.length} bytes`);const r="private/profiles/customers";this.logger.debug(`Uploading to folder: ${r}`);g=(await this.s3Service.uploadFile(e.profilePicture,r)).path,this.logger.log(`Profile picture uploaded to S3: ${g}`)}catch(e){const t=e instanceof Error?e.message:JSON.stringify(e);throw this.logger.error(`Failed to upload profile picture to S3: ${t}`),this.logger.error("Error details:",e),new l.BadRequestException(`File upload failed: ${t}`)}const y=await c.CustomerModel.startTransaction();try{const e=await c.UserModel.query(y).insert({firstName:s,middleName:a,lastName:u,businessPhone:o.businessPhone,mobilePhone:o.mobilePhone,gender:o.gender,status:!0,email:o.email,salutation:o.salutation,suffix:o.suffix,remark:o.remark,profilePicture:g,...p}),t=await c.CustomerModel.query(y).insert({userId:e.id,email:o.email,firstName:s,middleName:a,lastName:u,mobilePhone:o.mobilePhone,membershipType:o.membershipType,profilePicture:g,...p});return await c.UserAddressModel.query(y).insert({userId:e.id,addressType:f.AddressTypeEnum.Billing,country:i?.country,stateOrProvince:i?.province,city:i?.city,subDistrict:i?.subDistrict,village:i?.village,zipOrPostalCode:i?.postalCode,street:i?.street}),await c.UserAddressModel.query(y).insert({userId:e.id,addressType:f.AddressTypeEnum.Mailing,country:n?.country,stateOrProvince:n?.province,city:n?.city,subDistrict:n?.subDistrict,village:n?.village,zipOrPostalCode:n?.postalCode,street:n?.street}),await y.commit(),{id:t.id,userId:t.userId,email:t.email}}catch(e){throw await y.rollback(),e}}async updateCustomer(e,t,r){try{const o=await c.CustomerModel.query().findById(e);if(!o)throw new l.NotFoundException(`Customer with ID ${e} not found`);const i=this.transformFlattenedDtoToNested(t),{accountInformation:n,billingAddressInformation:s,mailingAddressInformation:a}=i;n&&Object.values(n).some(e=>e)&&await this.validateUniqueFieldsForUpdate(e,n);const u={updatedBy:r.userId,updatedAt:new Date};let p=null;if(t.profilePicture)try{const e="private/profiles/customers";if(p=(await this.s3Service.uploadFile(t.profilePicture,e)).path,this.logger.log(`Profile picture uploaded to S3: ${p}`),o.profilePicture)try{await this.s3Service.deleteFile(o.profilePicture),this.logger.log(`Old profile picture deleted from S3: ${o.profilePicture}`)}catch(e){this.logger.warn(`Failed to delete old profile picture: ${e.message}`)}}catch(e){throw this.logger.error(`Failed to upload profile picture to S3: ${e.message}`),new l.BadRequestException(`File upload failed: ${e.message}`)}const g=await c.CustomerModel.startTransaction();try{if(n&&Object.values(n).some(e=>e)){const e={...u};if(n.name){const{firstName:t,middleName:r,lastName:o}=(0,d.splitName)(n.name);t&&(e.firstName=t),r&&(e.middleName=r),o&&(e.lastName=o)}n.businessPhone&&(e.businessPhone=n.businessPhone),n.mobilePhone&&(e.mobilePhone=n.mobilePhone),n.gender&&(e.gender=n.gender),n.email&&(e.email=n.email),n.salutation&&(e.salutation=n.salutation),n.suffix&&(e.suffix=n.suffix),n.remark&&(e.remark=n.remark),await c.UserModel.query(g).findById(o.userId).patch(e)}const t={...u};if(n&&(n.email&&(t.email=n.email),n.mobilePhone&&(t.mobilePhone=n.mobilePhone),n.membershipType&&(t.membershipType=n.membershipType)),p&&(t.profilePicture=p),Object.keys(t).length>2&&await c.CustomerModel.query(g).findById(e).patch(t),s&&Object.values(s).some(e=>e)){const e={...u};s.country&&(e.country=s.country),s.province&&(e.stateOrProvince=s.province),s.city&&(e.city=s.city),s.subDistrict&&(e.subDistrict=s.subDistrict),s.village&&(e.village=s.village),s.postalCode&&(e.zipOrPostalCode=s.postalCode),s.street&&(e.street=s.street),Object.keys(e).length>2&&await c.UserAddressModel.query(g).where("userId",o.userId).where("addressType",f.AddressTypeEnum.Billing).patch(e)}if(a&&Object.values(a).some(e=>e)){const e={...u};a.country&&(e.country=a.country),a.province&&(e.stateOrProvince=a.province),a.city&&(e.city=a.city),a.subDistrict&&(e.subDistrict=a.subDistrict),a.village&&(e.village=a.village),a.postalCode&&(e.zipOrPostalCode=a.postalCode),a.street&&(e.street=a.street),Object.keys(e).length>2&&await c.UserAddressModel.query(g).where("userId",o.userId).where("addressType",f.AddressTypeEnum.Mailing).patch(e)}await g.commit();return await c.CustomerModel.query().findById(e)}catch(e){throw await g.rollback(),e}}catch(e){if(e instanceof l.NotFoundException||e instanceof l.BadRequestException||e instanceof g.ValidationException)throw e;throw new l.BadRequestException("Failed to update customer")}}async deleteCustomer(e,t){const r=await c.CustomerModel.query().findOne({id:e,deleteFlag:!1});if(!r)throw new l.NotFoundException(`Customer with ID ${e} not found or has been deleted`);return r.deletedBy=t.userId,r.deletedAt=new Date,r.deleteFlag=!0,await r.$query().patch(),{message:`Customer with ID ${e} deleted successfully`,id:e}}async searchByEmail(e){if(!e)throw new l.BadRequestException("Email is required");return await c.CustomerModel.query().where("email","ilike",`%${e}%`)}async searchByPhone(e){if(!e)throw new l.BadRequestException("Phone is required");return await c.CustomerModel.query().where("mobilePhone",e)}async searchByName(e,t){if(!e)throw new l.BadRequestException("First name is required");let r=c.CustomerModel.query().where("firstName","ilike",`%${e}%`);t&&(r=r.orWhere("lastName","ilike",`%${t}%`));return await r}async findAllRelatedCustomerByEmail(e){const t=await c.CustomerModel.query().where({email:e}),r=t.filter(e=>!!e.mobilePhone).map(e=>e.mobilePhone);return r.length?c.CustomerModel.query().where(t=>{t.orWhere({email:e}),r.forEach(e=>t.orWhere({mobilePhone:e}))}):Promise.resolve(t)}async findAllRelatedCustomerByPhone(e){const t=await c.CustomerModel.query().where({mobilePhone:e}),r=t.filter(e=>!!e.email).map(e=>e.email);return r.length?c.CustomerModel.query().where(t=>{t.orWhere({mobilePhone:e}),r.forEach(e=>t.orWhere({email:e}))}):Promise.resolve(t)}async getProfilePicturePresignedUrl(e,t){const r=await c.CustomerModel.query().findById(e);if(!r)throw new l.NotFoundException(`Customer with ID ${e} not found`);if(!r.profilePicture)return null;const o=(0,p.getPresignedUrlExpiresIn)(t),i=await this.s3Service.getPresignedUrl(r.profilePicture,o).catch(t=>{throw this.logger.error(`Failed to generate presigned URL for customer ${e}: ${t.message}`),new l.BadRequestException("Failed to generate presigned URL")});return this.logger.log(`Generated presigned URL for customer ${e} (expires in ${o}s)`),i}getPresignedUrlExpiresIn(e){const t=process.env.PRESIGNED_URL_EXPIRES_IN;if(t){const e=parseInt(t,10);if(!isNaN(e)&&e>0)return e}return e&&e>0?e:3600}async getProfilePictureDirectUrl(e){const t=await c.CustomerModel.query().findById(e);if(!t)throw new l.NotFoundException(`Customer with ID ${e} not found`);if(!t.profilePicture)return null;const r=`https://${this.s3Service.getBucketName()}/${t.profilePicture}`;return this.logger.log(`Generated direct URL for customer ${e}: ${r}`),r}async getProfilePictureUrl(e,t=!0,r){return t?this.getProfilePicturePresignedUrl(e,r):this.getProfilePictureDirectUrl(e)}};t.CustomerService=b,t.CustomerService=b=n([(0,l.Injectable)(),a(0,(0,l.Inject)(l.Logger)),a(0,(0,l.Optional)()),s("design:paramtypes",["function"==typeof(o=void 0!==l.LoggerService&&l.LoggerService)?o:Object,"function"==typeof(i=void 0!==h.S3Service&&h.S3Service)?i:Object])],b)},5057:function(e,t,r){var o=this&&this.__decorate||function(e,t,r,o){var i,n=arguments.length,s=n<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(s=(n<3?i(s):n>3?i(t,r,s):i(t,r))||s);return n>3&&s&&Object.defineProperty(t,r,s),s};Object.defineProperty(t,"__esModule",{value:!0}),t.RbacService=void 0;const i=r(1813),n=r(1944),s=r(3020);let a=class{async moduleList(e){return(0,s.simplePaginatedList)(n.ModuleModel.query(),e)}async roleList(e){return(0,s.simplePaginatedList)(n.RoleModel.query(),e)}async permissionList(e){return(0,s.simplePaginatedList)(n.PermissionModel.query(),e)}async createRole(e){return n.RoleModel.query().insert(e)}async getRoleById(e){return n.RoleModel.query().findById(e)}async updateRole(e,t){return n.RoleModel.query().patchAndFetchById(e,t)}async deleteRole(e){return n.RoleModel.query().deleteById(e)}};t.RbacService=a,t.RbacService=a=o([(0,i.Injectable)()],a)},5063:function(e,t,r){var o,i=this&&this.__decorate||function(e,t,r,o){var i,n=arguments.length,s=n<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(s=(n<3?i(s):n>3?i(t,r,s):i(t,r))||s);return n>3&&s&&Object.defineProperty(t,r,s),s},n=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},s=this&&this.__param||function(e,t){return function(r,o){t(r,o,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.ModelService=void 0;const a=r(1813),l=r(1944),c=r(4014),d=r(4413);let u=class{constructor(e){this.logger=e,this.MODEL_SEARCH_COLUMNS=["name","regionalCategory"],e||(this.logger=new a.Logger("ModelService"))}async create(e){try{const t=await l.ModelModel.query().insert(e);return this.logger.log(`Model created with id: ${t.id}`),t}catch(e){throw this.logger.error(`Error creating model: ${e.message}`),e}}async findAll(e){try{let t,r;const o=l.ModelModel.query(),i=l.ModelModel.query();e?.filters&&(this.logger.log("apply filters data"),(0,d.applyFilters)(e.filters,o),(0,d.applyFilters)(e.filters,i)),e?.sorts&&(this.logger.log("apply sort data"),(0,d.applySorts)(e.sorts,o)),e instanceof c.PaginationDto&&(t=e.page,r=e.count,this.logger.log("apply pagination data"),(0,d.applyPagination)({page:t,count:r},o));const[n,s]=await Promise.all([o,i.count("* as count")]);return{page:t,count:r,total:parseInt(s[0]?.count),items:n}}catch(e){throw this.logger.error(`Error finding all models: ${e.message}`),e}}async findById(e){try{const t=await l.ModelModel.query().findById(e);if(!t)throw new a.NotFoundException(`Model with id ${e} not found`);return t}catch(e){throw this.logger.error(`Error finding model by id: ${e.message}`),e}}async update(e,t){try{const r=await this.findById(e),o=await r.$query().updateAndFetch(t);return this.logger.log(`Model ${e} updated`),o}catch(e){throw this.logger.error(`Error updating model: ${e.message}`),e}}async delete(e){try{const t=await this.findById(e);await t.$query().delete(),this.logger.log(`Model ${e} deleted`)}catch(e){throw this.logger.error(`Error deleting model: ${e.message}`),e}}};t.ModelService=u,t.ModelService=u=i([(0,a.Injectable)(),s(0,(0,a.Inject)(a.Logger)),s(0,(0,a.Optional)()),n("design:paramtypes",["function"==typeof(o=void 0!==a.LoggerService&&a.LoggerService)?o:Object])],u)},5075:function(e,t,r){var o,i=this&&this.__decorate||function(e,t,r,o){var i,n=arguments.length,s=n<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(s=(n<3?i(s):n>3?i(t,r,s):i(t,r))||s);return n>3&&s&&Object.defineProperty(t,r,s),s},n=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},s=this&&this.__param||function(e,t){return function(r,o){t(r,o,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.ProductService=void 0;const a=r(1813),l=r(1944),c=r(4014),d=r(4413);let u=class{constructor(e){this.logger=e,this.PRODUCT_SEARCH_COLUMNS=["name","materialNumber"],e||(this.logger=new a.Logger("ProductService"))}async create(e){try{const t=await l.ProductModel.query().insert(e);return this.logger.log(`Product created with id: ${t.id}`),t}catch(e){throw this.logger.error(`Error creating product: ${e.message}`),e}}async findAll(e){try{let t,r;const o=l.ProductModel.query().withGraphFetched("model"),i=l.ProductModel.query();e?.filters&&(this.logger.log("apply filters data"),(0,d.applyFilters)(e.filters,o),(0,d.applyFilters)(e.filters,i)),e?.sorts&&(this.logger.log("apply sort data"),(0,d.applySorts)(e.sorts,o)),e instanceof c.PaginationDto&&(t=e.page,r=e.count,this.logger.log("apply pagination data"),(0,d.applyPagination)({page:t,count:r},o));const[n,s]=await Promise.all([o,i.count("* as count")]);return{page:t,count:r,total:parseInt(s[0]?.count),items:n}}catch(e){throw this.logger.error(`Error finding all products: ${e.message}`),e}}async findById(e){try{const t=await l.ProductModel.query().findById(e).withGraphFetched("model");if(!t)throw new a.NotFoundException(`Product with id ${e} not found`);return t}catch(e){throw this.logger.error(`Error finding product by id: ${e.message}`),e}}async update(e,t){try{const r=await this.findById(e),o=await r.$query().updateAndFetch(t);return this.logger.log(`Product ${e} updated`),o}catch(e){throw this.logger.error(`Error updating product: ${e.message}`),e}}async delete(e){try{const t=await this.findById(e);await t.$query().delete(),this.logger.log(`Product ${e} deleted`)}catch(e){throw this.logger.error(`Error deleting product: ${e.message}`),e}}async findByModelId(e){try{return await l.ProductModel.query().where("modelId",e).withGraphFetched("model")}catch(e){throw this.logger.error(`Error finding products by model id: ${e.message}`),e}}};t.ProductService=u,t.ProductService=u=i([(0,a.Injectable)(),s(0,(0,a.Inject)(a.Logger)),s(0,(0,a.Optional)()),n("design:paramtypes",["function"==typeof(o=void 0!==a.LoggerService&&a.LoggerService)?o:Object])],u)},5084:function(e,t,r){var o=this&&this.__createBinding||(Object.create?function(e,t,r,o){void 0===o&&(o=r);var i=Object.getOwnPropertyDescriptor(t,r);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,o,i)}:function(e,t,r,o){void 0===o&&(o=r),e[o]=t[r]}),i=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||o(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),i(r(6881),t),i(r(1495),t)},5096:e=>{e.exports=require("cookie")},5285:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.JwtModuleOptionsProvider=void 0;const o=r(4383),i=r(9124);t.JwtModuleOptionsProvider={provide:i.JWT_MODULE_OPTIONS,useFactory(){const e={signOptions:{algorithm:"ES256"}};if(process.env.JWT_PRIVATE_KEY)e.privateKey=process.env.JWT_PRIVATE_KEY;else{const t=process.env.JWT_PRIVATE_KEY_FILE||"key_private.pem";(0,o.existsSync)(t)&&(e.privateKey=(0,o.readFileSync)(t,"ascii"))}if(process.env.JWT_PUBLIC_KEY?e.publicKey=process.env.JWT_PUBLIC_KEY:e.publicKey=(0,o.readFileSync)(process.env.JWT_PUBLIC_KEY_FILE||"key_public.pem","ascii"),!e.publicKey)throw new Error("Cakrawala Library [Auth Module] require at least JWT_PUBLIC_KEY");return e}}},5306:(e,t)=>{var r;Object.defineProperty(t,"__esModule",{value:!0}),t.TokenApp=void 0,function(e){e[e.UNKNOWN=0]="UNKNOWN",e[e.CUSTOMER=1]="CUSTOMER",e[e.PARTNER=2]="PARTNER",e[e.TECHNICIAN=3]="TECHNICIAN"}(r||(t.TokenApp=r={}))},5323:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0});const o=r(7861);class i extends o.Model{}i.tableName="UserAddresses",i.idColumn="id",i.jsonSchema={type:"object",properties:{id:{type:"integer"},userId:{type:"integer"},addressType:{type:"string"},country:{type:"string"},street:{type:"string"},city:{type:"string"},subDistrict:{type:"string"},stateOrProvince:{type:"string"},zipOrPostalCode:{type:"integer"},village:{type:"string"}}},t.default=i},5364:function(e,t,r){var o=this&&this.__createBinding||(Object.create?function(e,t,r,o){void 0===o&&(o=r);var i=Object.getOwnPropertyDescriptor(t,r);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,o,i)}:function(e,t,r,o){void 0===o&&(o=r),e[o]=t[r]}),i=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||o(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),i(r(8153),t),i(r(5864),t),i(r(900),t)},5432:function(e,t,r){var o=this&&this.__decorate||function(e,t,r,o){var i,n=arguments.length,s=n<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(s=(n<3?i(s):n>3?i(t,r,s):i(t,r))||s);return n>3&&s&&Object.defineProperty(t,r,s),s},i=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(t,"__esModule",{value:!0}),t.CreateWorkOrderDto=void 0;const n=r(6325);class s{}t.CreateWorkOrderDto=s,o([(0,n.IsString)({message:"Work order number must be a string"}),i("design:type",String)],s.prototype,"woNumber",void 0),o([(0,n.IsString)({message:"NSC Malaysia must be a string"}),i("design:type",String)],s.prototype,"nscMalaysia",void 0),o([(0,n.IsInt)({message:"Case ID must be an integer"}),(0,n.IsOptional)(),i("design:type",Number)],s.prototype,"caseId",void 0),o([(0,n.IsString)({message:"Work type must be a string"}),i("design:type",String)],s.prototype,"workType",void 0),o([(0,n.IsString)({message:"Job type must be a string"}),i("design:type",String)],s.prototype,"jobType",void 0),o([(0,n.IsInt)({message:"Work order status ID must be an integer"}),i("design:type",Number)],s.prototype,"woStatusId",void 0),o([(0,n.IsInt)({message:"Work order sub-status ID must be an integer"}),i("design:type",Number)],s.prototype,"woSubStatusId",void 0),o([(0,n.IsInt)({message:"Job reason ID must be an integer"}),i("design:type",Number)],s.prototype,"jobReasonId",void 0),o([(0,n.IsString)({message:"Priority must be a string"}),i("design:type",String)],s.prototype,"priority",void 0),o([(0,n.IsString)({message:"Subject must be a string"}),i("design:type",String)],s.prototype,"subject",void 0),o([(0,n.IsString)({message:"Description must be a string"}),i("design:type",String)],s.prototype,"description",void 0),o([(0,n.IsInt)({message:"Customer ID must be an integer"}),i("design:type",Number)],s.prototype,"customerId",void 0),o([(0,n.IsString)({message:"Customer type must be a string"}),i("design:type",String)],s.prototype,"customerType",void 0),o([(0,n.IsInt)({message:"IRIS ID must be an integer"}),i("design:type",Number)],s.prototype,"irisId",void 0),o([(0,n.IsString)({message:"Schedule date must be a string"}),i("design:type",String)],s.prototype,"scheduleDate",void 0),o([(0,n.IsInt)({message:"Claim ID must be a string"}),i("design:type",Number)],s.prototype,"claimId",void 0)},5448:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.operatorMapNoSQL=t.operatorMapSQL=void 0,t.operatorMapSQL=Object.freeze({equal:"=",notEqual:"!=",lessThan:"<",greaterThan:">"}),t.operatorMapNoSQL=Object.freeze({equal:"$eq",notEqual:"$ne",lessThan:"$lt",greaterThan:"$gt",in:"$in",notIn:"$nin"})},5487:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.NoLogin=function(){return i(!1)},t.Action=function(e,t){return i(e,t)};const o=r(9124),i=(e,t)=>{const r=(r,i,n)=>{let s;return n&&(r=n.value),s=!1!==e&&{module:t,action:e},Reflect.defineMetadata(o.PERMISSION_METADATA,s,r),n||r};return r.KEY=o.PERMISSION_METADATA,r}},5501:function(e,t,r){var o,i=this&&this.__decorate||function(e,t,r,o){var i,n=arguments.length,s=n<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(s=(n<3?i(s):n>3?i(t,r,s):i(t,r))||s);return n>3&&s&&Object.defineProperty(t,r,s),s},n=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},s=this&&this.__param||function(e,t){return function(r,o){t(r,o,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.WarrantyService=void 0;const a=r(1813),l=r(1944),c=r(4014),d=r(4413);let u=class{constructor(e){this.logger=e,this.WARRANTY_SEARCH_COLUMNS=["serialNumber","salesOrderNumber","status"],e||(this.logger=new a.Logger("WarrantyService"))}async create(e){try{const t=await l.WarrantyModel.query().insert(e);return this.logger.log(`Warranty created with id: ${t.id}`),t}catch(e){throw this.logger.error(`Error creating warranty: ${e.message}`),e}}async findAll(e){try{let t,r;const o=l.WarrantyModel.query().withGraphFetched("dealer"),i=l.WarrantyModel.query();e?.filters&&(this.logger.log("apply filters data"),(0,d.applyFilters)(e.filters,o),(0,d.applyFilters)(e.filters,i)),e?.sorts&&(this.logger.log("apply sort data"),(0,d.applySorts)(e.sorts,o)),e instanceof c.PaginationDto&&(t=e.page,r=e.count,this.logger.log("apply pagination data"),(0,d.applyPagination)({page:t,count:r},o));const[n,s]=await Promise.all([o,i.count("* as count")]);return{page:t,count:r,total:parseInt(s[0]?.count),items:n}}catch(e){throw this.logger.error(`Error finding all warranties: ${e.message}`),e}}async findById(e){try{const t=await l.WarrantyModel.query().findById(e).withGraphFetched("dealer");if(!t)throw new a.NotFoundException(`Warranty with id ${e} not found`);return t}catch(e){throw this.logger.error(`Error finding warranty by id: ${e.message}`),e}}async update(e,t){try{const r=await this.findById(e),o=await r.$query().updateAndFetch(t);return this.logger.log(`Warranty ${e} updated`),o}catch(e){throw this.logger.error(`Error updating warranty: ${e.message}`),e}}async delete(e){try{const t=await this.findById(e);await t.$query().delete(),this.logger.log(`Warranty ${e} deleted`)}catch(e){throw this.logger.error(`Error deleting warranty: ${e.message}`),e}}async findByDealerId(e){try{return await l.WarrantyModel.query().where("dealerId",e).withGraphFetched("dealer")}catch(e){throw this.logger.error(`Error finding warranties by dealer id: ${e.message}`),e}}async findByCustomerId(e){try{return await l.WarrantyModel.query().where("customerId",e).withGraphFetched("dealer")}catch(e){throw this.logger.error(`Error finding warranties by customer id: ${e.message}`),e}}};t.WarrantyService=u,t.WarrantyService=u=i([(0,a.Injectable)(),s(0,(0,a.Inject)(a.Logger)),s(0,(0,a.Optional)()),n("design:paramtypes",["function"==typeof(o=void 0!==a.LoggerService&&a.LoggerService)?o:Object])],u)},5536:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0})},5635:function(e,t,r){var o=this&&this.__createBinding||(Object.create?function(e,t,r,o){void 0===o&&(o=r);var i=Object.getOwnPropertyDescriptor(t,r);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,o,i)}:function(e,t,r,o){void 0===o&&(o=r),e[o]=t[r]}),i=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||o(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),i(r(7976),t),i(r(1706),t),i(r(1227),t),i(r(9338),t),i(r(9474),t)},5725:e=>{e.exports=require("@aws-sdk/client-s3")},5780:e=>{e.exports=require("@nestjs/microservices")},5864:function(e,t,r){var o=this&&this.__decorate||function(e,t,r,o){var i,n=arguments.length,s=n<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(s=(n<3?i(s):n>3?i(t,r,s):i(t,r))||s);return n>3&&s&&Object.defineProperty(t,r,s),s};Object.defineProperty(t,"__esModule",{value:!0}),t.S3Module=void 0;const i=r(1813),n=r(8153),s=r(900);let a=class{};t.S3Module=a,t.S3Module=a=o([(0,i.Module)({providers:[n.S3Service,s.S3InitializerService],exports:[n.S3Service]})],a)},5877:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0})},5906:function(e,t,r){var o=this&&this.__createBinding||(Object.create?function(e,t,r,o){void 0===o&&(o=r);var i=Object.getOwnPropertyDescriptor(t,r);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,o,i)}:function(e,t,r,o){void 0===o&&(o=r),e[o]=t[r]}),i=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||o(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),i(r(8072),t),i(r(345),t),i(r(9944),t),i(r(8709),t)},5947:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0})},5950:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0});const o=r(7861),i=r(7729),n=r(171);class s extends o.Model{}s.tableName=i.constants.TableName.WorkOrders,s.idColumn="id",s.relationMappings={customer:{relation:o.Model.BelongsToOneRelation,modelClass:i.CustomerModel,join:{from:`${i.constants.TableName.WorkOrders}.customerId`,to:`${i.constants.TableName.Customers}.id`}},status:{relation:o.Model.BelongsToOneRelation,modelClass:n.default,join:{from:`${i.constants.TableName.WorkOrders}.woStatusId`,to:`${i.constants.TableName.WorkOrderStatus}.id`}}},t.default=s},6046:e=>{e.exports=require("knex")},6077:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0})},6088:function(e,t,r){var o=this&&this.__createBinding||(Object.create?function(e,t,r,o){void 0===o&&(o=r);var i=Object.getOwnPropertyDescriptor(t,r);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,o,i)}:function(e,t,r,o){void 0===o&&(o=r),e[o]=t[r]}),i=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||o(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),i(r(3716),t),i(r(9722),t),i(r(7637),t),i(r(1770),t),i(r(8703),t),i(r(919),t),i(r(1409),t),i(r(1606),t),i(r(8536),t),i(r(6381),t),i(r(6496),t),i(r(225),t),i(r(9031),t)},6150:function(e,t,r){var o=this&&this.__createBinding||(Object.create?function(e,t,r,o){void 0===o&&(o=r);var i=Object.getOwnPropertyDescriptor(t,r);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,o,i)}:function(e,t,r,o){void 0===o&&(o=r),e[o]=t[r]}),i=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||o(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),i(r(4873),t),i(r(872),t),i(r(932),t),i(r(3691),t),i(r(6245),t)},6172:function(e,t,r){var o=this&&this.__decorate||function(e,t,r,o){var i,n=arguments.length,s=n<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(s=(n<3?i(s):n>3?i(t,r,s):i(t,r))||s);return n>3&&s&&Object.defineProperty(t,r,s),s};Object.defineProperty(t,"__esModule",{value:!0}),t.DeleteWorkOrderUseCase=void 0;const i=r(1813),n=r(6245);let s=class{constructor(){this.logger=new i.Logger("CreateWorkOrderUseCase"),this.result=!1}async execute(e){return this.params=e,await this.findData(),await this.updateData(),this.result}async findData(){this.data=await n.WorkOrderModel.query().findOne({id:this.params.id,deletedAt:null})}async updateData(){if(!this.data)throw new i.NotFoundException(`Work order with ID ${this.params.id} not found`);this.data.deletedAt=new Date,this.data.deletedBy=this.params.token.userId;const e=await n.WorkOrderModel.query().findById(this.params.id).patch(this.data);this.result=e>0}};t.DeleteWorkOrderUseCase=s,t.DeleteWorkOrderUseCase=s=o([(0,i.Injectable)()],s)},6245:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.WorkOrderJobReasonModel=t.WorkOrderSubStatusModel=t.WorkOrderStatusModel=t.WorkOrderModel=void 0;var o=r(5950);Object.defineProperty(t,"WorkOrderModel",{enumerable:!0,get:function(){return o.default}});var i=r(171);Object.defineProperty(t,"WorkOrderStatusModel",{enumerable:!0,get:function(){return i.default}});var n=r(4218);Object.defineProperty(t,"WorkOrderSubStatusModel",{enumerable:!0,get:function(){return n.default}});var s=r(7359);Object.defineProperty(t,"WorkOrderJobReasonModel",{enumerable:!0,get:function(){return s.default}})},6325:e=>{e.exports=require("class-validator")},6329:function(e,t,r){var o=this&&this.__decorate||function(e,t,r,o){var i,n=arguments.length,s=n<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(s=(n<3?i(s):n>3?i(t,r,s):i(t,r))||s);return n>3&&s&&Object.defineProperty(t,r,s),s};Object.defineProperty(t,"__esModule",{value:!0}),t.TechnicianService=void 0;const i=r(1813),n=r(3171),s=r(8347),a=r(4014);let l=class{async listTechnicians(e,t){const r=n.default.query().withGraphFetched("user").modifyGraph("user",e=>{e.select("id","firstName","lastName","email","mobilePhone")});return t&&r.where(e=>{e.where("nsc","like",`%${t}%`).orWhereExists(s.default.query().whereColumn("users.id","Technicians.userId").where(e=>{e.where("firstName","ilike",`%${t}%`).orWhere("lastName","ilike",`%${t}%`)}))}),e?(0,a.simplePaginatedList)(r,e):r}async getTechnicianById(e){return n.default.query().findById(e).withGraphFetched("user")}};t.TechnicianService=l,t.TechnicianService=l=o([(0,i.Injectable)()],l)},6341:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0});const o=r(7861),i=r(4588),n=r(8239);class s extends o.Model{static get relationMappings(){return{dealer:{relation:o.Model.BelongsToOneRelation,modelClass:i.default,join:{from:`${n.TableName.Warranties}.dealerId`,to:`${n.TableName.Dealers}.id`}}}}}s.tableName=n.TableName.Warranties,t.default=s},6381:(e,t)=>{var r;Object.defineProperty(t,"__esModule",{value:!0}),t.NSCEnum=void 0,function(e){e.None="None",e.CAC_PAT="CAC-PAT",e.CAC_PAU="CAC-PAU",e.CAC_PGI="CAC-PGI",e.CAC_PSV="CAC-PSV",e.PAT="PAT",e.PGI="PGI",e.PM="PM",e.PACMY="PACMY",e.PASSAP="PASSAP",e.PSV="PSV",e.PISCAP="PISCAP",e.PMIC="PMIC",e.Hussmann="Hussmann",e.PSP="PSP",e.PNZ="PNZ",e.PPH="PPH",e.PSTH="PSTH",e.PAMB="PAMB",e.PACB="PACB",e.PM_PACMY="PM/PACMY",e.PACVN="PACVN",e.GMC="GMC",e.PAPMAP="PAPMAP",e.PACPH="PACPH",e.PAU="PAU",e.PPNDTH="PPNDTH"}(r||(t.NSCEnum=r={}))},6496:(e,t)=>{var r;Object.defineProperty(t,"__esModule",{value:!0}),t.MembershipTypeEnum=void 0,function(e){e.None="None",e.Standard="Standard",e.Silver="Silver",e.Gold="Gold",e.Platinum="Platinum",e.Diamond="Diamond"}(r||(t.MembershipTypeEnum=r={}))},6578:function(e,t,r){var o=this&&this.__decorate||function(e,t,r,o){var i,n=arguments.length,s=n<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(s=(n<3?i(s):n>3?i(t,r,s):i(t,r))||s);return n>3&&s&&Object.defineProperty(t,r,s),s};Object.defineProperty(t,"__esModule",{value:!0}),t.MasterDataModule=void 0;const i=r(1813),n=r(9227);let s=class{};t.MasterDataModule=s,t.MasterDataModule=s=o([(0,i.Module)({providers:[n.MasterDataService],exports:[n.MasterDataService]})],s)},6631:e=>{e.exports=require("multer")},6661:e=>{e.exports=require("@nestjs/jwt")},6881:function(e,t,r){var o=this&&this.__decorate||function(e,t,r,o){var i,n=arguments.length,s=n<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(s=(n<3?i(s):n>3?i(t,r,s):i(t,r))||s);return n>3&&s&&Object.defineProperty(t,r,s),s},i=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(t,"__esModule",{value:!0}),t.PaginationDto=void 0,r(1321);const n=r(284),s=r(6325),a=r(7621),l=r(1916),c=r(581),d=r(1495),u=r(3020),p=r(2520);class f{constructor(){this.page=1,this.count=10}getOffset(){return(0,u.paginationExtractOffsetAndLimit)(this).offset}}t.PaginationDto=f,o([(0,s.IsInt)(),(0,s.IsPositive)(),(0,s.Min)(1),(0,n.Type)(()=>Number),(0,p.ApiProperty)({description:"Current page number begining from 1",required:!0,example:1,type:"number"}),i("design:type",Object)],f.prototype,"page",void 0),o([(0,s.IsInt)(),(0,s.IsPositive)(),(0,s.Min)(1),(0,s.Max)(100),(0,n.Type)(()=>Number),(0,p.ApiProperty)({description:"Item per-page count",required:!0,example:10,type:"number"}),i("design:type",Object)],f.prototype,"count",void 0),o([(0,s.IsOptional)(),(0,l.IsSingleKeyObjectWithEnum)(a.PaginationSortOrder,{each:!0}),(0,s.IsArray)(),(0,n.Transform)(c.sortsTransformer),(0,p.ApiProperty)({description:"Array of sorting items",required:!1,isArray:!0,type:"array"}),i("design:type",Array)],f.prototype,"sorts",void 0),o([(0,s.IsOptional)(),(0,l.IsOneOf)([d.PaginationFilterOrDto,d.PaginationFilterAndDto]),(0,s.ValidateNested)({each:!0}),(0,n.Transform)(c.filtersTransformer),(0,p.ApiProperty)({type:"array",description:"Filters object with Array or Object as OR and AND logic",required:!1,isArray:!0}),i("design:type",Object)],f.prototype,"filters",void 0)},6963:function(e,t,r){var o=this&&this.__decorate||function(e,t,r,o){var i,n=arguments.length,s=n<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(s=(n<3?i(s):n>3?i(t,r,s):i(t,r))||s);return n>3&&s&&Object.defineProperty(t,r,s),s};Object.defineProperty(t,"__esModule",{value:!0}),t.InvoiceService=void 0;const i=r(1813),n=r(5e3),s=r(4014);let a=class{async listInvoices(e,t,r){const o=n.default.query();return r&&o.where("workOrderId",r),t&&o.where("invoiceNumber","like",`%${t}%`).orWhere("status","like",`%${t}%`),e?(0,s.simplePaginatedList)(o,e):o}async getInvoiceById(e){const t=await n.default.query().findById(e);if(!t)throw new i.NotFoundException(`Invoice with ID ${e} not found`);return t}async createInvoice(e){return n.default.query().insert(e)}async updateInvoice(e,t){return(await this.getInvoiceById(e)).$query().patchAndFetch(t)}async deleteInvoice(e){if(0===await n.default.query().deleteById(e))throw new i.NotFoundException(`Invoice with ID ${e} not found`);return{success:!0,id:e}}};t.InvoiceService=a,t.InvoiceService=a=o([(0,i.Injectable)()],a)},7118:function(e,t,r){var o=this&&this.__decorate||function(e,t,r,o){var i,n=arguments.length,s=n<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(s=(n<3?i(s):n>3?i(t,r,s):i(t,r))||s);return n>3&&s&&Object.defineProperty(t,r,s),s};Object.defineProperty(t,"__esModule",{value:!0}),t.PartnerModule=void 0;const i=r(1813),n=r(823);let s=class{};t.PartnerModule=s,t.PartnerModule=s=o([(0,i.Module)({providers:[n.PartnerService],exports:[n.PartnerService]})],s)},7127:function(e,t,r){var o,i=this&&this.__decorate||function(e,t,r,o){var i,n=arguments.length,s=n<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(s=(n<3?i(s):n>3?i(t,r,s):i(t,r))||s);return n>3&&s&&Object.defineProperty(t,r,s),s},n=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},s=this&&this.__param||function(e,t){return function(r,o){t(r,o,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.AssetService=void 0;const a=r(1813),l=r(1944),c=r(4014),d=r(4413);let u=class{constructor(e){this.logger=e,this.ASSET_SEARCH_COLUMNS=["name","compressorNo","serialNumberType","status"],e||(this.logger=new a.Logger("AssetService"))}async create(e){try{const t=await l.AssetModel.query().insert(e);return this.logger.log(`Asset created with id: ${t.id}`),t}catch(e){throw this.logger.error(`Error creating asset: ${e.message}`),e}}async findAll(e){try{let t,r;const o=l.AssetModel.query().withGraphFetched("[product, model, warranty, parent]"),i=l.AssetModel.query();e?.filters&&(this.logger.log("apply filters data"),(0,d.applyFilters)(e.filters,o),(0,d.applyFilters)(e.filters,i)),e?.sorts&&(this.logger.log("apply sort data"),(0,d.applySorts)(e.sorts,o)),e instanceof c.PaginationDto&&(t=e.page,r=e.count,this.logger.log("apply pagination data"),(0,d.applyPagination)({page:t,count:r},o));const[n,s]=await Promise.all([o,i.count("* as count")]);return{page:t,count:r,total:parseInt(s[0]?.count),items:n}}catch(e){throw this.logger.error(`Error finding all assets: ${e.message}`),e}}async findById(e){try{const t=await l.AssetModel.query().findById(e).withGraphFetched("[product, model, warranty, parent, children]");if(!t)throw new a.NotFoundException(`Asset with id ${e} not found`);return t}catch(e){throw this.logger.error(`Error finding asset by id: ${e.message}`),e}}async update(e,t){try{const r=await this.findById(e),o=await r.$query().updateAndFetch(t);return this.logger.log(`Asset ${e} updated`),o}catch(e){throw this.logger.error(`Error updating asset: ${e.message}`),e}}async delete(e){try{const t=await this.findById(e);await t.$query().delete(),this.logger.log(`Asset ${e} deleted`)}catch(e){throw this.logger.error(`Error deleting asset: ${e.message}`),e}}async findByProductId(e){try{return await l.AssetModel.query().where("productId",e).withGraphFetched("[product, model, warranty]")}catch(e){throw this.logger.error(`Error finding assets by product id: ${e.message}`),e}}async findByModelId(e){try{return await l.AssetModel.query().where("modelId",e).withGraphFetched("[product, model, warranty]")}catch(e){throw this.logger.error(`Error finding assets by model id: ${e.message}`),e}}async findByWarrantyId(e){try{return await l.AssetModel.query().where("warantyId",e).withGraphFetched("[product, model, warranty]")}catch(e){throw this.logger.error(`Error finding assets by warranty id: ${e.message}`),e}}async findChildren(e){try{return await l.AssetModel.query().where("parentAssetId",e).withGraphFetched("[product, model, warranty, children]")}catch(e){throw this.logger.error(`Error finding child assets: ${e.message}`),e}}async findByCustomerId(e){try{return await l.AssetModel.query().where("customerId",e).withGraphFetched("[product, model, warranty]")}catch(e){throw this.logger.error(`Error finding assets by customer id: ${e.message}`),e}}};t.AssetService=u,t.AssetService=u=i([(0,a.Injectable)(),s(0,(0,a.Inject)(a.Logger)),s(0,(0,a.Optional)()),n("design:paramtypes",["function"==typeof(o=void 0!==a.LoggerService&&a.LoggerService)?o:Object])],u)},7175:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.AuthExpiredAccessTokenException=t.AuthForbiddenException=void 0;const o=r(1813),i=r(4671);class n extends o.ForbiddenException{constructor(e){let t="You don't have permission to ";Array.isArray(e)?t+=e.map(e=>(0,i.stringifyAccess)(e)).join(" OR "):t+=(0,i.stringifyAccess)(e),super(t),this.missingAccess=e}}t.AuthForbiddenException=n;class s extends Error{constructor(e="Access Token expired"){super(e)}}t.AuthExpiredAccessTokenException=s},7326:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.CreateSampleDto=t.SampleDto=void 0;t.SampleDto=class{};t.CreateSampleDto=class{}},7359:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0});const o=r(7861),i=r(7729);class n extends o.Model{}n.tableName=i.constants.TableName.WorkOrderJobReason,n.idColumn="id",n.jsonSchema={type:"object",properties:{id:{type:"integer"},work_order_sub_status_id:{type:"integer"},slug:{type:"string"},name:{type:"string"},created_at:{type:"string"},created_by:{type:"integer"}}},t.default=n},7435:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.databaseProviders=t.KNEX_CONNECTION=void 0;const o=r(7861),i=r(6046),n=r(1514),s=r(1813);t.KNEX_CONNECTION="KNEX_CONNECTION",t.databaseProviders=[{provide:t.KNEX_CONNECTION,inject:[n.ConfigService],useFactory:async e=>{const t=new s.Logger("Database"),r=(0,i.default)({client:"pg",connection:e.get("DATABASE_URL"),pool:{min:1,max:parseInt(e.get("DATABASE_POOLS_MAX","10")),afterCreate:(e,r)=>{t.verbose(`Pool opened: ${e.__knexUid}`),e.once("error",r=>{t.error(`Database connection error (${e.__knexUid}): ${r.message||r}`)}),e.once("close",()=>{t.verbose(`Pool closed: ${e.__knexUid}`)}),r(null,e)}},acquireConnectionTimeout:3e4});o.Model.knex(r);try{await r.raw("SELECT 1")}catch(e){throw new Error(`Database Module Error: ${e.message||e}`)}return r}}]},7507:function(e,t,r){var o=this&&this.__createBinding||(Object.create?function(e,t,r,o){void 0===o&&(o=r);var i=Object.getOwnPropertyDescriptor(t,r);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,o,i)}:function(e,t,r,o){void 0===o&&(o=r),e[o]=t[r]}),i=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||o(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),i(r(2087),t),i(r(8526),t)},7546:e=>{e.exports=require("@nestjs/common/utils/shared.utils")},7578:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0})},7598:e=>{e.exports=require("node:crypto")},7621:(e,t)=>{var r,o;Object.defineProperty(t,"__esModule",{value:!0}),t.Pagination=t.FilterOperator=t.PaginationSortOrder=void 0,function(e){e.ASC="ASC",e.DESC="DESC"}(r||(t.PaginationSortOrder=r={})),function(e){e.equal="equal",e.notEqual="notEqual",e.like="like",e.between="between",e.lessThan="lessThan",e.greaterThan="greaterThan",e.isNull="isNull",e.isNotNull="isNotNull",e.in="in",e.notIn="notIn"}(o||(t.FilterOperator=o={}));t.Pagination=class{}},7637:(e,t)=>{var r;Object.defineProperty(t,"__esModule",{value:!0}),t.WorkOrderCustomerTypeEnum=void 0,function(e){e.None="None",e.Customer="customer",e.Dealer="dealer",e.Subdealer="subdealer",e.ASCUser="ASC (user)",e.Internal="internal"}(r||(t.WorkOrderCustomerTypeEnum=r={}))},7652:function(e,t,r){var o=this&&this.__decorate||function(e,t,r,o){var i,n=arguments.length,s=n<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(s=(n<3?i(s):n>3?i(t,r,s):i(t,r))||s);return n>3&&s&&Object.defineProperty(t,r,s),s};Object.defineProperty(t,"__esModule",{value:!0}),t.ChargeModule=void 0;const i=r(1813),n=r(4773);let s=class{};t.ChargeModule=s,t.ChargeModule=s=o([(0,i.Module)({providers:[n.ChargeService],exports:[n.ChargeService]})],s)},7729:function(e,t,r){var o=this&&this.__createBinding||(Object.create?function(e,t,r,o){void 0===o&&(o=r);var i=Object.getOwnPropertyDescriptor(t,r);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,o,i)}:function(e,t,r,o){void 0===o&&(o=r),e[o]=t[r]}),i=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||o(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),t.constants=t.enums=void 0,i(r(8111),t),i(r(3487),t),i(r(1206),t),t.enums=r(6088),t.constants=r(8239),i(r(1944),t),i(r(9344),t),i(r(9586),t),i(r(7507),t),i(r(9846),t),i(r(287),t),i(r(606),t),i(r(2848),t),i(r(9493),t),i(r(6150),t),i(r(4014),t),i(r(266),t),i(r(8430),t),i(r(9044),t),i(r(5635),t),i(r(8566),t),i(r(8875),t),i(r(3847),t),i(r(4457),t),i(r(494),t),i(r(4500),t),i(r(5364),t),i(r(803),t),i(r(1212),t),i(r(2490),t),i(r(9837),t),i(r(5906),t)},7819:e=>{e.exports=require("@nestjs/core")},7861:e=>{e.exports=require("objection")},7976:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.splitName=function(e){if(!e)return{firstName:"",middleName:"",lastName:""};const t=e.trim().split(/\s+/);if(1===t.length)return{firstName:t[0],middleName:"",lastName:""};if(2===t.length)return{firstName:t[0],middleName:"",lastName:t[1]};if(3===t.length)return{firstName:t[0],middleName:t[1],lastName:t[2]};return{firstName:t[0],middleName:t[1],lastName:t.slice(2).join(" ")}}},8072:function(e,t,r){var o=this&&this.__decorate||function(e,t,r,o){var i,n=arguments.length,s=n<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(s=(n<3?i(s):n>3?i(t,r,s):i(t,r))||s);return n>3&&s&&Object.defineProperty(t,r,s),s};Object.defineProperty(t,"__esModule",{value:!0}),t.NatsModule=void 0;const i=r(1813),n=r(1514),s=r(345),a=r(5780);let l=class{};t.NatsModule=l,t.NatsModule=l=o([(0,i.Module)({imports:[n.ConfigModule],providers:[i.Logger,{provide:"NATS_SERVICE",useFactory:e=>{const t=e.get("NATS_URL");return a.ClientProxyFactory.create({transport:a.Transport.NATS,options:{servers:[t],jetstream:!0,connection:{debug:!1,reconnect:!0,maxReconnectAttempts:-1,waitOnFirstConnect:!0}}})},inject:[n.ConfigService]},s.NatsService],exports:[i.Logger,"NATS_SERVICE",s.NatsService]})],l)},8109:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0})},8111:function(e,t,r){var o=this&&this.__createBinding||(Object.create?function(e,t,r,o){void 0===o&&(o=r);var i=Object.getOwnPropertyDescriptor(t,r);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,o,i)}:function(e,t,r,o){void 0===o&&(o=r),e[o]=t[r]}),i=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||o(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),i(r(2982),t),i(r(7435),t)},8153:function(e,t,r){var o=this&&this.__decorate||function(e,t,r,o){var i,n=arguments.length,s=n<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(s=(n<3?i(s):n>3?i(t,r,s):i(t,r))||s);return n>3&&s&&Object.defineProperty(t,r,s),s},i=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(t,"__esModule",{value:!0}),t.S3Service=void 0;const n=r(1813),s=r(5725),a=r(4991);let l=class{constructor(){this.logger=new n.Logger("S3Service");const e=process.env.END_POINT,t=process.env.ACCESS_KEY,r=process.env.SECRET,o=process.env.BUCKET;e&&t&&r&&o?(this.bucket=o,this.endpoint=`https://${e}`,this.s3Client=new s.S3Client({region:"us-east-1",endpoint:this.endpoint,forcePathStyle:!0,credentials:{accessKeyId:t,secretAccessKey:r}}),this.logger.log(`S3Service initialized with bucket: ${this.bucket}`),this.logger.log(`S3 Endpoint: ${this.endpoint}`)):this.logger.warn("S3 configuration is incomplete. S3 upload will be disabled.")}async uploadFile(e,t="dummy",r){try{const o=Date.now(),i=Math.floor(1e6*Math.random()),n=e.originalname.split(".").pop(),a=`${t}/${r||`${o}-${i}.${n}`}`;this.logger.log(`Uploading file to S3: ${a}`);const l=new s.PutObjectCommand({Bucket:this.bucket,Key:a,Body:e.buffer,ContentType:e.mimetype});await this.s3Client.send(l);const c=`https://${this.bucket}/${a}`;return this.logger.log(`File uploaded successfully: ${c}`),{key:a,url:c,path:a}}catch(e){const t=e?.message||e?.Code||String(e);throw this.logger.error(`Failed to upload file: ${t}`),e?.Code&&this.logger.error(`AWS Error Code: ${e.Code}`),e?.$metadata&&this.logger.error("AWS Metadata:",e.$metadata),this.logger.error("Full error:",JSON.stringify(e,null,2)),e}}async deleteFile(e){try{this.logger.log(`Deleting file from S3: ${e}`);const t=new s.DeleteObjectCommand({Bucket:this.bucket,Key:e});await this.s3Client.send(t),this.logger.log(`File deleted successfully: ${e}`)}catch(e){throw this.logger.error(`Failed to delete file: ${e.message}`),e}}async getPresignedUrl(e,t=3600){try{this.logger.log(`Generating presigned URL for: ${e}`);const r=new s.GetObjectCommand({Bucket:this.bucket,Key:e}),o=await(0,a.getSignedUrl)(this.s3Client,r,{expiresIn:t});return this.logger.log(`Presigned URL generated (expires in ${t}s)`),o}catch(e){throw this.logger.error(`Failed to generate presigned URL: ${e.message}`),e}}isConfigured(){return!!this.s3Client&&!!this.bucket}getBucketName(){return this.bucket}getEndpoint(){return this.endpoint}};t.S3Service=l,t.S3Service=l=o([(0,n.Injectable)(),i("design:paramtypes",[])],l)},8239:function(e,t,r){var o=this&&this.__createBinding||(Object.create?function(e,t,r,o){void 0===o&&(o=r);var i=Object.getOwnPropertyDescriptor(t,r);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,o,i)}:function(e,t,r,o){void 0===o&&(o=r),e[o]=t[r]}),i=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||o(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),i(r(1193),t)},8347:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0});const o=r(7861),i=r(9857),n=r(7729);class s extends o.Model{}s.tableName=n.constants.TableName.Users,s.idColumn="id",s.relationMappings={role:{modelClass:i.default,relation:o.Model.HasOneRelation,join:{from:`${n.constants.TableName.Users}.roleId`,to:`${n.constants.TableName.Roles}.id`}}},t.default=s},8352:function(e,t,r){var o=this&&this.__decorate||function(e,t,r,o){var i,n=arguments.length,s=n<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(s=(n<3?i(s):n>3?i(t,r,s):i(t,r))||s);return n>3&&s&&Object.defineProperty(t,r,s),s};Object.defineProperty(t,"__esModule",{value:!0}),t.RbacModule=void 0;const i=r(1813),n=r(5057);let s=class{};t.RbacModule=s,t.RbacModule=s=o([(0,i.Module)({providers:[n.RbacService],exports:[n.RbacService]})],s)},8430:function(e,t,r){var o=this&&this.__createBinding||(Object.create?function(e,t,r,o){void 0===o&&(o=r);var i=Object.getOwnPropertyDescriptor(t,r);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,o,i)}:function(e,t,r,o){void 0===o&&(o=r),e[o]=t[r]}),i=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||o(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),i(r(4222),t),i(r(8491),t),i(r(3120),t)},8446:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0})},8491:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.InterceptorResponse=void 0;t.InterceptorResponse=class{constructor(e,t,r){this.message=e,this.result=t,this.statusCode=r}getResponse(){const e=Object.create(null);return e.message=this.message,this.statusCode&&(e.statusCode=this.statusCode),this.result&&(e.result=this.result),e}}},8509:function(e,t,r){var o,i,n,s=this&&this.__decorate||function(e,t,r,o){var i,n=arguments.length,s=n<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(s=(n<3?i(s):n>3?i(t,r,s):i(t,r))||s);return n>3&&s&&Object.defineProperty(t,r,s),s},a=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},l=this&&this.__param||function(e,t){return function(r,o){t(r,o,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.AuthenticationService=void 0;const c=r(1813),d=r(6661),u=r(9124),p=r(5306),f=r(4754);let g=class{constructor(e,t,r){this.jwtService=e,this.jwtModuleOptions=t,this.logger=r,r||(this.logger=new c.Logger("AuthService")),this.expiresIn=f(process.env.JWT_ACCESS_TOKEN_EXPIRES_IN||"30m"),this.rembemberMeExpiresIn=f(process.env.JWT_ACCESS_TOKEN_REMEMBER_EXPIRES_IN||"7 days")}generateToken(e,t,r){r=r||this.expiresIn,this.logger.log(`Generating acces token for ID ${e} expires in ${r}`);const o={userId:e,app:t};return this.jwtService.sign(o,{expiresIn:r})}decodeToken(e){return this.logger.verbose(`Decoding JWT token ${(e||"").slice(0,10)}*******`),this.jwtService.decode(e)}isThisRoleAllowedToLoginApp(e,t){if(!e)return!1;switch(t){case p.TokenApp.CUSTOMER:return"customer"==e;case p.TokenApp.TECHNICIAN:return e.startsWith("technis");case p.TokenApp.PARTNER:return"customer"!=e&&!e.startsWith("technis");default:return!1}}};t.AuthenticationService=g,t.AuthenticationService=g=s([(0,c.Injectable)(),l(1,(0,c.Inject)(u.JWT_MODULE_OPTIONS)),l(2,(0,c.Inject)(c.Logger)),l(2,(0,c.Optional)()),a("design:paramtypes",["function"==typeof(o=void 0!==d.JwtService&&d.JwtService)?o:Object,"function"==typeof(i=void 0!==d.JwtModuleOptions&&d.JwtModuleOptions)?i:Object,"function"==typeof(n=void 0!==c.LoggerService&&c.LoggerService)?n:Object])],g)},8526:function(e,t,r){var o=this&&this.__decorate||function(e,t,r,o){var i,n=arguments.length,s=n<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(s=(n<3?i(s):n>3?i(t,r,s):i(t,r))||s);return n>3&&s&&Object.defineProperty(t,r,s),s};Object.defineProperty(t,"__esModule",{value:!0}),t.OtpModule=void 0;const i=r(1813),n=r(2087);let s=class{};t.OtpModule=s,t.OtpModule=s=o([(0,i.Module)({providers:[n.OtpService],exports:[n.OtpService]})],s)},8536:(e,t)=>{var r;Object.defineProperty(t,"__esModule",{value:!0}),t.GenderEnum=void 0,function(e){e.None="None",e.Male="Male",e.Female="Female"}(r||(t.GenderEnum=r={}))},8566:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.AssetService=t.AssetModule=void 0;var o=r(862);Object.defineProperty(t,"AssetModule",{enumerable:!0,get:function(){return o.AssetModule}});var i=r(7127);Object.defineProperty(t,"AssetService",{enumerable:!0,get:function(){return i.AssetService}})},8570:function(e,t,r){var o=this&&this.__decorate||function(e,t,r,o){var i,n=arguments.length,s=n<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(s=(n<3?i(s):n>3?i(t,r,s):i(t,r))||s);return n>3&&s&&Object.defineProperty(t,r,s),s};Object.defineProperty(t,"__esModule",{value:!0}),t.InvoiceModule=void 0;const i=r(1813),n=r(6963);let s=class{};t.InvoiceModule=s,t.InvoiceModule=s=o([(0,i.Module)({providers:[n.InvoiceService],exports:[n.InvoiceService]})],s)},8659:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.UpdateWorkOrderDto=void 0;const o=r(5007),i=r(5432);class n extends((0,o.PartialType)(i.CreateWorkOrderDto)){}t.UpdateWorkOrderDto=n},8703:(e,t)=>{var r;Object.defineProperty(t,"__esModule",{value:!0}),t.LocationTypeEnum=void 0,function(e){e.None="None",e.WarehouseIGP="Warehouse - IGP",e.WarehouseFOC="Warehouse - FOC",e.WarehouseDiscount="Warehouse - Discount",e.WarehouseCampaign="Warehouse - Campaign",e.WarehouseASCLocal="Warehouse - ASC Local Location"}(r||(t.LocationTypeEnum=r={}))},8709:(e,t)=>{var r,o,i;Object.defineProperty(t,"__esModule",{value:!0}),t.CHANNEL_DISPATCHER_TYPE=t.NATS_CHANNEL_ACTION=t.CHANNEL_SENDER_DISPATCHER=void 0,t.unwrapNatsPayload=function(e){if(!e)return e;if("object"==typeof e&&"data"in e&&null!=e.data){const t=e.data;return"object"==typeof t&&t&&"data"in t&&null!=t.data?t.data:t}return e},function(e){e.CHANNEL_SEND_EMAIL="CAKRAWALA-HUB-SEND-EMAIL",e.CHANNEL_SEND_WHATSAPP="CAKRAWALA-HUB-SEND-WHATSAPP"}(r||(t.CHANNEL_SENDER_DISPATCHER=r={})),function(e){e.ACTIVATION_USER="ACTIVATION_USER",e.RESET_PASSWORD="RESET_PASSWORD",e.SURVEY_OTP_WEB="SURVEY_OTP_WEB",e.EXPORT="EXPORT"}(o||(t.NATS_CHANNEL_ACTION=o={})),function(e){e.EMAIL="EMAIL",e.WHATSAPP="WHATSAPP"}(i||(t.CHANNEL_DISPATCHER_TYPE=i={}))},8749:e=>{e.exports=require("crypto")},8875:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.DealerService=t.DealerModule=void 0;var o=r(2618);Object.defineProperty(t,"DealerModule",{enumerable:!0,get:function(){return o.DealerModule}});var i=r(2563);Object.defineProperty(t,"DealerService",{enumerable:!0,get:function(){return i.DealerService}})},8956:function(e,t,r){var o,i=this&&this.__decorate||function(e,t,r,o){var i,n=arguments.length,s=n<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(s=(n<3?i(s):n>3?i(t,r,s):i(t,r))||s);return n>3&&s&&Object.defineProperty(t,r,s),s},n=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(t,"__esModule",{value:!0}),t.AuthenticationModule=void 0;const s=r(1813),a=r(6661),l=r(4602),c=r(8509),d=r(9124),u=r(1357),p=r(911),f=r(7819),g=r(5285);let y=class{constructor(e){this.modulesContainer=e,this.logger=new s.Logger("AuthPermissionsScanner")}onApplicationBootstrap(){const e=new f.MetadataScanner;for(const[t,r]of this.modulesContainer){const o=r.metatype?.name??t?.toString();if(!o)continue;const i=r.controllers;if(!i||"object"!=typeof i||!i.size)continue;const n=o.replace(/Module$/,"").replace(/([a-z0-9])([A-Z])/g,"$1-$2").replace(/\s+/g,"-").toLowerCase();for(const[t,r]of i){const t=e.getAllMethodNames(r.instance);for(const e of t){const t=Reflect.getMetadata(d.PERMISSION_METADATA,r.instance[e]);t&&(t.module||(t.module=n),this.logger.verbose(`${o}/${e}: ModuleSlug: ${t.module}, Action: ${t.action}`))}}}}};t.AuthenticationModule=y,t.AuthenticationModule=y=i([(0,s.Module)({imports:[l.PassportModule],providers:[c.AuthenticationService,a.JwtService,u.AccessTokenStrategy,p.AccessTokenGuard,g.JwtModuleOptionsProvider,{provide:s.Logger,useValue:new s.Logger("Authentication")},{provide:f.APP_GUARD,useExisting:p.AccessTokenGuard}],exports:[d.JWT_MODULE_OPTIONS,u.AccessTokenStrategy,c.AuthenticationService,p.AccessTokenGuard]}),n("design:paramtypes",["function"==typeof(o=void 0!==f.ModulesContainer&&f.ModulesContainer)?o:Object])],y)},9031:(e,t)=>{var r;Object.defineProperty(t,"__esModule",{value:!0}),t.NSCMYEnum=void 0,function(e){e.PM="PM",e.PACMY="PACMY"}(r||(t.NSCMYEnum=r={}))},9044:function(e,t,r){var o=this&&this.__createBinding||(Object.create?function(e,t,r,o){void 0===o&&(o=r);var i=Object.getOwnPropertyDescriptor(t,r);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,o,i)}:function(e,t,r,o){void 0===o&&(o=r),e[o]=t[r]}),i=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||o(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),i(r(9787),t),i(r(3219),t),i(r(1960),t)},9124:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.MODULE_SLUG=t.PERMISSION_METADATA=t.AUTH_GUARD=t.JWT_MODULE_OPTIONS=void 0,t.JWT_MODULE_OPTIONS="JWT_MODULE_OPTIONS",t.AUTH_GUARD="AUTH_GUARD",t.PERMISSION_METADATA=Symbol("PERMISSION"),t.MODULE_SLUG=Symbol("MODULE_SLUG")},9144:function(e,t,r){var o=this&&this.__createBinding||(Object.create?function(e,t,r,o){void 0===o&&(o=r);var i=Object.getOwnPropertyDescriptor(t,r);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,o,i)}:function(e,t,r,o){void 0===o&&(o=r),e[o]=t[r]}),i=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||o(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),i(r(193),t)},9200:e=>{e.exports=require("passport-jwt")},9227:function(e,t,r){var o=this&&this.__decorate||function(e,t,r,o){var i,n=arguments.length,s=n<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(s=(n<3?i(s):n>3?i(t,r,s):i(t,r))||s);return n>3&&s&&Object.defineProperty(t,r,s),s};Object.defineProperty(t,"__esModule",{value:!0}),t.MasterDataService=void 0;const i=r(1813),n=r(1714),s=r(7359),a=r(171),l=r(4014);let c=class{async listIrisCodes(e,t){const r=n.default.query().whereNull("deletedAt");return t&&r.where(e=>{e.where("symptomCode","like",`%${t}%`).orWhere("defectCode","like",`%${t}%`).orWhere("conditionCode","like",`%${t}%`)}),e?(0,l.simplePaginatedList)(r,e):r}async getIrisCodeById(e){return n.default.query().findById(e)}async listJobReasons(e,t){const r=s.default.query();return t&&r.where("name","like",`%${t}%`).orWhere("slug","like",`%${t}%`),e?(0,l.simplePaginatedList)(r,e):r}async listWorkOrderStatuses(){return a.default.query()}};t.MasterDataService=c,t.MasterDataService=c=o([(0,i.Injectable)()],c)},9338:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.normalizePhoneNumber=function(e){if(!e)throw new Error("Phone number empty");if("string"!=typeof e)throw new Error("Phone number is not string");if((e=e.trim()).length<6)throw new Error("Phone number to short");e.startsWith("+")?e=e.slice(1):e.startsWith("08")&&(e="62"+e.slice(2));return e.replace(/[^0-9]/g,"")}},9344:function(e,t,r){var o=this&&this.__createBinding||(Object.create?function(e,t,r,o){void 0===o&&(o=r);var i=Object.getOwnPropertyDescriptor(t,r);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,o,i)}:function(e,t,r,o){void 0===o&&(o=r),e[o]=t[r]}),i=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||o(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),i(r(2067),t),i(r(1284),t),i(r(2213),t)},9347:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0})},9474:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.getPresignedUrlExpiresIn=function(e){const t=process.env.PRESIGNED_URL_EXPIRES_IN;if(t){const e=i(t);if(e>0)return e}if(void 0!==e){const t=i(e);if(t>0)return t}return 3600},t.parseExpirationValue=i;const o=r(4754);function i(e){if("number"==typeof e)return isNaN(e)||e<=0?0:e;if("string"==typeof e)try{const t=o(e);if("number"==typeof t&&t>0)return Math.floor(t/1e3)}catch(e){return 0}return 0}},9493:function(e,t,r){var o=this&&this.__createBinding||(Object.create?function(e,t,r,o){void 0===o&&(o=r);var i=Object.getOwnPropertyDescriptor(t,r);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,o,i)}:function(e,t,r,o){void 0===o&&(o=r),e[o]=t[r]}),i=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||o(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),i(r(3147),t),i(r(2386),t)},9498:function(e,t,r){var o=this&&this.__decorate||function(e,t,r,o){var i,n=arguments.length,s=n<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(s=(n<3?i(s):n>3?i(t,r,s):i(t,r))||s);return n>3&&s&&Object.defineProperty(t,r,s),s};Object.defineProperty(t,"__esModule",{value:!0}),t.ProductModule=void 0;const i=r(1813),n=r(5075);let s=class{};t.ProductModule=s,t.ProductModule=s=o([(0,i.Module)({providers:[n.ProductService],exports:[n.ProductService]})],s)},9586:function(e,t,r){var o=this&&this.__createBinding||(Object.create?function(e,t,r,o){void 0===o&&(o=r);var i=Object.getOwnPropertyDescriptor(t,r);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,o,i)}:function(e,t,r,o){void 0===o&&(o=r),e[o]=t[r]}),i=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||o(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),i(r(8509),t),i(r(8956),t),i(r(4671),t),i(r(5487),t),i(r(9124),t),i(r(5285),t),i(r(911),t),i(r(1357),t)},9709:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0});const o=r(7861),i=r(7729);class n extends o.Model{}n.tableName=i.constants.TableName.Charges,n.idColumn="id",n.jsonSchema={type:"object",required:["id","workOrderId","name","amount","currency"],properties:{id:{type:"integer"},workOrderId:{type:"integer"},name:{type:"string"},amount:{type:"number"},currency:{type:"string"},createdAt:{type:"string"},createdBy:{type:"integer"}}},t.default=n},9722:(e,t)=>{var r;Object.defineProperty(t,"__esModule",{value:!0}),t.WorkOrderJobTypeEnum=void 0,function(e){e.None="None",e.WalkIn="Walk-In",e.OnSite="On-Site",e.Transfer="Transfer"}(r||(t.WorkOrderJobTypeEnum=r={}))},9787:function(e,t,r){var o,i=this&&this.__decorate||function(e,t,r,o){var i,n=arguments.length,s=n<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(s=(n<3?i(s):n>3?i(t,r,s):i(t,r))||s);return n>3&&s&&Object.defineProperty(t,r,s),s},n=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(t,"__esModule",{value:!0}),t.ExceptionHandler=void 0;const s=r(1813),a=r(7819),l=r(3219);let c=class extends a.BaseExceptionFilter{constructor(e){super(e?.httpAdapter),this.logger=new s.Logger("GlobalException")}catch(e,t){let r;if(this.logTheError(e),e instanceof l.ValidationException){const r=e.getResponse();return e.errorFields&&Object.keys(e.errorFields).length>0&&(r.errorFields=e.errorFields),super.catch(e,t)}if(e instanceof l.ApiException)return super.catch(e,t);if(e instanceof s.HttpException){const t=e.getResponse(),o=e.getStatus();let i=[],n={};if("string"==typeof t)i=t;else if("error"in t)if(Array.isArray(t.message)){i=t.message;const e={};t.message.forEach(t=>{const r=t.match(/^([a-zA-Z.]+)\s(.+)$/);if(r){const t=r[1],o=r[2];e[t]||(e[t]=[]),e[t].push(o)}}),Object.keys(e).length>0&&(n=e)}else i=t.message;if(r=new l.ApiException(o,i,e.cause),Object.keys(n).length>0){r.getResponse().errorFields=n}}else e instanceof Error&&(r=new l.ApiException(s.HttpStatus.INTERNAL_SERVER_ERROR,e.message));return super.catch(r||e,t)}logTheError(e){e instanceof s.HttpException?this.logger.error(`statusCode: ${e.getStatus()}, message: ${JSON.stringify(e.getResponse())}`):this.logger.error(e)}};t.ExceptionHandler=c,t.ExceptionHandler=c=i([(0,s.Catch)(),n("design:paramtypes",["function"==typeof(o=void 0!==a.HttpAdapterHost&&a.HttpAdapterHost)?o:Object])],c)},9835:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.multerOptions=t.multerStorageConfig=t.multerImageOptions=t.multerMemoryStorageConfig=void 0;const o=r(6631);t.multerMemoryStorageConfig=(0,o.memoryStorage)(),t.multerImageOptions={storage:t.multerMemoryStorageConfig,limits:{fileSize:function(){const e=process.env.MAX_FILE_SIZE_KB;if(e){const t=parseInt(e,10);if(!isNaN(t)&&t>0)return 1024*t}return 1048576}()},fileFilter:(e,t,r)=>{const o=["image/jpeg","image/png","image/gif","image/webp"];o.includes(t.mimetype)?r(null,!0):r(new Error(`Invalid file type. Only ${o.join(", ")} are allowed.`),!1)}},t.multerStorageConfig=t.multerMemoryStorageConfig,t.multerOptions=t.multerImageOptions},9837:function(e,t,r){var o=this&&this.__createBinding||(Object.create?function(e,t,r,o){void 0===o&&(o=r);var i=Object.getOwnPropertyDescriptor(t,r);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,o,i)}:function(e,t,r,o){void 0===o&&(o=r),e[o]=t[r]}),i=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||o(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),i(r(8570),t),i(r(6963),t),i(r(43),t)},9846:function(e,t,r){var o=this&&this.__decorate||function(e,t,r,o){var i,n=arguments.length,s=n<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(s=(n<3?i(s):n>3?i(t,r,s):i(t,r))||s);return n>3&&s&&Object.defineProperty(t,r,s),s};Object.defineProperty(t,"__esModule",{value:!0}),t.LibraryModule=void 0;const i=r(1813),n=r(287);let s=class{};t.LibraryModule=s,t.LibraryModule=s=o([(0,i.Global)(),(0,i.Module)({providers:[n.LibraryService],exports:[n.LibraryService],imports:[]})],s)},9856:e=>{e.exports=require("http")},9857:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0});const o=r(7861),i=r(7729);class n extends o.Model{}n.tableName=i.constants.TableName.Roles,n.idColumn="id",n.relationMappings={role:{modelClass:i.UserModel,relation:o.Model.HasManyRelation,join:{from:`${i.constants.TableName.Roles}.id`,to:`${i.constants.TableName.Users}.roleId`}}},n.jsonSchema={type:"object",properties:{id:{type:"integer"},slug:{type:"string"},name:{type:"string"},description:{type:"string"},isAdmin:{type:"boolean"},isArea:{type:"boolean"},permissions:{type:"array",items:{type:"integer"}},status:{type:"boolean"}}},t.default=n},9944:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.NATS_SUBJECTS=t.NATS_STREAMS=void 0,t.NATS_STREAMS={SEND_WHATSAPP:"CAKRAWALA-HUB-SEND-WHATSAPP",SEND_EMAIL:"CAKRAWALA-HUB-SEND-EMAIL"},t.NATS_SUBJECTS={SEND_WHATSAPP:"CAKRAWALA-HUB-SEND-WHATSAPP",SEND_EMAIL:"CAKRAWALA-HUB-SEND-EMAIL"}}},t={};var r=function r(o){var i=t[o];if(void 0!==i)return i.exports;var n=t[o]={exports:{}};return e[o].call(n.exports,n,n.exports,r),n.exports}(7729);module.exports=r})();